{"version":3,"sources":["image_upload.min.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"imageUpload","vendor","options","vendorConfig","then","config","$","extend","accept","timeout","compress","max_width","max_height","Upload","getThumbnailUrl","response","suffix","url","upload_ret","split","charCodeAt","getUrl","each","index","element","data","trigger","success","uid","parseJSON","error","thumbnailUrl","message","err","progress","slice","arguments","select","this","submit","./lib/upload","./lib/vendor_config",2,"module","global","file","Promise","resolve","window","File","FileReader","URL","test","type","reader","readAsArrayBuffer","onload","event","blob","Blob","target","result","webkitURL","blobURL","createObjectURL","image","Image","src","dataURI","resize","dataURItoBlob","reject","img","width","height","quality","Math","round","canvas","document","createElement","ctx","getContext","drawImage","toDataURL","byteString","indexOf","atob","unescape","mimeString","ia","Uint8Array","ES6Promise","polyfill","self",3,"settings","name","action","multiple","setup","bind","createInputs","map","value","key","prop","findzIndex","$node","zIndex","parents","item","css","parseInt","newIframe","iframeCount","hide","prototype","form","method","enctype","append","input","$trigger","outerWidth","offsetWidth","outerHeight","offsetHeight","position","left","top","opacity","outline","cursor","offset","overflow","appendTo","mouseenter","bindInput","files","on","pop","uids","promise","FormData","ajaxSubmit","formSubmit","refreshInput","promiseArr","get","ajax","processData","contentType","xhr","ajaxSettings","upload","addEventListener","percent","loaded","total","lengthComputable","ceil","textStatus","errorThrown","push","all","iframe","one","clearTimeout","timer","remove","trim","contents","find","html","setTimeout","newInput","clone","before","off","callback","./compress",4,"getJson","dataType","getConfig","location","origin","protocol","hostname","port","query","return-url","cache","toUpperCase","uploadUrl","uploadParams","fileKey"],"mappings":"CAAA,QAAUA,GAAEC,EAAEC,EAAEC,GAAG,QAASC,GAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,GAAIE,GAAkB,kBAATC,UAAqBA,OAAQ,KAAIF,GAAGC,EAAE,MAAOA,GAAEF,GAAE,EAAI,IAAGI,EAAE,MAAOA,GAAEJ,GAAE,EAAI,IAAIK,GAAE,GAAIC,OAAM,uBAAuBN,EAAE,IAAK,MAAMK,GAAEE,KAAK,mBAAmBF,EAAE,GAAIG,GAAEX,EAAEG,IAAIS,WAAYb,GAAEI,GAAG,GAAGU,KAAKF,EAAEC,QAAQ,SAASd,GAAG,GAAIE,GAAED,EAAEI,GAAG,GAAGL,EAAG,OAAOI,GAAEF,EAAEA,EAAEF,IAAIa,EAAEA,EAAEC,QAAQd,EAAEC,EAAEC,EAAEC,GAAG,MAAOD,GAAEG,GAAGS,QAAkD,IAAI,GAA1CL,GAAkB,kBAATD,UAAqBA,QAAgBH,EAAE,EAAEA,EAAEF,EAAEa,OAAOX,IAAID,EAAED,EAAEE,GAAI,OAAOD,KAAKa,GAAG,SAAST,GAUxc,QAASU,GAAYC,EAAQC,GASzB,MARsB,gBAAXD,KACPC,EAAUD,EACVA,EAAS,SAEbA,EAASA,GAAU,QACI,gBAAZC,KACPA,MAEGC,EAAa,QAASF,GAAQG,KAAK,SAAUC,GAShD,MARAC,GAAEC,OAAOF,GACLG,OAAQ,UACRC,QAAS,IACTC,UACIC,UAAW,IACXC,WAAY,MAEjBV,GACI,GAAIW,GAAOR,KA3B1B,GAAIQ,GAASvB,EAAQ,gBACjBa,EAAeb,EAAQ,sBAqC3BwB,iBAAkB,SAAUb,EAAQc,EAAUC,GAC1Cf,EAASA,GAAU,OACnB,IAAIgB,GAAMF,EAASE,KAAOF,EAASG,WAAWD,GAG9C,OAFAA,GAAMA,EAAIE,MAAM,KAAK,GACrBH,EAASA,EAAU,IAAMA,EAAU,MACpB,UAAXf,EACO,cAAgBgB,EAAIG,WAAW,GAAK,EAAI,GAAK,eAAiBH,EAAMD,EACzD,UAAXf,EACA,2BAA6BgB,EAAMD,EADvC,QAWXK,OAAS,SAAUpB,EAAQc,GACvBd,EAASA,GAAU,OACnB,IAAIgB,GAAMF,EAASE,KAAOF,EAASG,WAAWD,GAC9CA,GAAMA,EAAIE,MAAM,KAAK,EACrB,IAAIH,GAAS,EAMb,OALe,UAAXf,GAAiC,aAAXA,EACtBe,EAAS,MACS,UAAXf,IACPe,EAAS,OAENC,EAAMD,GAIjBV,EAAE,WACEA,EAAE,uBAAuBgB,KAAK,SAAUC,EAAOC,GAC3C,GAAIvB,GAASK,EAAEkB,GAASC,KAAK,UACzBjB,EAASF,EAAEkB,GAASC,KAAK,UACzBT,EAASV,EAAEkB,GAASC,KAAK,SAC7BzB,GAAYC,GACRyB,QAASpB,EAAEkB,GACXhB,OAAQA,EACRmB,QAAS,SAAUZ,EAAUa,GAIzB,GAHwB,gBAAbb,KACPA,EAAWT,EAAEuB,UAAUd,IAEL,MAAlBA,EAASrB,MAA4B,UAAXO,IAAuBc,EAASe,MAAQ,CAClE,GAAIC,GAAejB,gBAAgBb,EAAQc,EAAUC,GACjDC,EAAMI,OAAOpB,EAAQc,EACzBT,GAAEkB,GAASE,QAAQ,sBAAuBK,EAAcd,EAAKW,QAE7DtB,GAAEkB,GAASE,QAAQ,oBAAqBX,EAASiB,SAAWjB,EAASe,MAAOF,KAGpFE,MAAO,SAAUG,EAAKL,GACE,0BAAhBK,EAAID,SACJ1B,EAAEkB,GAASE,QAAQ,sBAAuBE,IAE9CtB,EAAEkB,GAASE,QAAQ,oBAAqBO,EAAID,QAASJ,KAEzDM,SAAU,WACN5B,EAAEkB,GAASE,QAAQ,yBAA0BS,MAAMtC,KAAKuC,UAAW,KAEvEC,OAAQ,WACJ/B,EAAEkB,GAASE,QAAQ,uBAAwBS,MAAMtC,KAAKuC,UAAW,IACjEE,KAAKC,YAEV,SAAS,SAAUN,GAClB3B,EAAEkB,GAASE,QAAQ,mBAAoBO,EAAID,iBAMpDQ,eAAe,EAAEC,sBAAsB,IAAIC,GAAG,SAASpD,EAAQqD,IAClE,SAAWC,GACX,YAWA,SAASlC,GAASmC,EAAM3C,GAGpB,MAAIA,MAAY,EACL4C,QAAQC,QAAQF,GAItBG,OAAOC,MAASD,OAAOE,YAAeF,OAAOG,IAK5CN,YAAgBI,MAKjB,SAAWG,KAAKP,EAAKQ,OAGH,gBAAZnD,KACPA,MAEG,GAAI4C,SAAQ,SAAUC,GAGzB,GAAIO,GAAS,GAAIJ,WACjBI,GAAOC,kBAAkBV,GACzBS,EAAOE,OAAS,SAAUC,GAGtB,GAAIC,GAAO,GAAIC,OAAMF,EAAMG,OAAOC,QAClCb,QAAOG,IAAMH,OAAOG,KAAOH,OAAOc,SAClC,IAAIC,GAAUf,OAAOG,IAAIa,gBAAgBN,GAGrCO,EAAQ,GAAIC,MAChBD,GAAME,IAAMJ,EACZE,EAAMT,OAAS,WAGX,GAAIY,GAAUC,EAAOJ,EAAOpB,EAAKQ,KAAMnD,GACnCwD,EAAOY,EAAcF,EACzBrB,GAAQW,QAzBTZ,QAAQyB,OAAO,GAAI9E,OAAM,sBALzBqD,QAAQyB,OAAO,GAAI9E,OAAM,iBALzBqD,QAAQyB,OAAO,GAAI9E,OAAM,yBAgDxC,QAAS4E,GAAOG,EAAKnB,EAAMnD,GACvB,GAAIuE,GAAQD,EAAIC,MACZC,EAASF,EAAIE,OACb/D,EAAYT,EAAQS,WAAa8D,EACjC7D,EAAaV,EAAQU,YAAc8D,EACnCC,EAAUzE,EAAQyE,SAAW,IAG7BF,GAAQC,EACJD,EAAQ9D,IACR+D,EAASE,KAAKC,MAAMH,GAAU/D,EAAY8D,GAC1CA,EAAQ9D,GAGR+D,EAAS9D,IACT6D,EAAQG,KAAKC,MAAMJ,GAAS7D,EAAa8D,GACzCA,EAAS9D,EAKjB,IAAIkE,GAASC,SAASC,cAAc,SACpCF,GAAOL,MAAQA,EACfK,EAAOJ,OAASA,CAChB,IAAIO,GAAMH,EAAOI,WAAW,KAE5B,OADAD,GAAIE,UAAUX,EAAK,EAAG,EAAGC,EAAOC,GACzBI,EAAOM,UAAU/B,EAAMsB,GAQlC,QAASL,GAAcF,GACnB,GAAIiB,GAAa,EAEbA,GADAjB,EAAQjD,MAAM,KAAK,GAAGmE,QAAQ,WAAa,EAC9BC,KAAKnB,EAAQjD,MAAM,KAAK,IAGxBqE,SAASpB,EAAQjD,MAAM,KAAK,GAQ7C,KAAK,GAJDsE,GAAarB,EAAQjD,MAAM,KAAK,GAAGA,MAAM,KAAK,GAAGA,MAAM,KAAK,GAG5DuE,EAAK,GAAIC,YAAWN,EAAWvF,QAC1BP,EAAI,EAAGA,EAAI8F,EAAWvF,OAAQP,IACnCmG,EAAGnG,GAAK8F,EAAWjE,WAAW7B,EAElC,OAAO,IAAIoE,OAAM+B,IAAMrC,KAAMoC,IArHjC,GAAIG,GAAgC,mBAAX5C,QAAyBA,OAAO4C,WAA+B,mBAAXhD,GAAyBA,EAAOgD,WAAa,IAC1HA,GAAWC,WAuHXlD,EAAO/C,QAAUc,IAEdb,KAAKyC,KAAuB,mBAAXM,QAAyBA,OAAyB,mBAATkD,MAAuBA,KAAyB,mBAAX9C,QAAyBA,gBACrH+C,GAAG,SAASzG,EAAQqD,IAC1B,SAAWC,GAOX,YAaA,SAAS/B,GAAOX,GACZ,KAAMoC,eAAgBzB,IAClB,MAAO,IAAIA,GAAOX,EAEC,iBAAZA,KACPA,KAEJ,IAAI8F,IACAtE,QAAS,KACTuE,KAAM,OACNC,OAAQ,UACR1F,OAAQ,KACRiB,KAAM,KACN0E,UAAU,EACV9D,OAAQ,KACRP,MAAO,KACPH,QAAS,KACTO,SAAU,KACVxB,UAAU,EACVD,QAAS,IAIb,IAFAH,EAAEC,OAAOyF,EAAU9F,GACnBoC,KAAK0D,SAAWA,GACX1F,EAAEgC,KAAK0D,SAAStE,SAAS5B,OAC1B,KAAML,OAAM,gCAGhB6C,MAAK8D,QACL9D,KAAK+D,OAiTT,QAASC,GAAa7E,GAClB,MAAKA,GACEnB,EAAEiG,IAAI9E,EAAM,SAAU+E,EAAOC,GAChC,MAAOnG,GAAE,mBAAmBoG,MACxBrD,KAAM,SACN4C,KAAMQ,EACND,MAAOA,SAUnB,QAASG,GAAWC,GAChB,GAAIC,GAAS,CASb,OARAvG,GAAEgB,KAAKsF,EAAME,UAAW,SAAUvF,EAAOwF,GACrC,MAAIA,KAASzG,EAAE,QAAQ,IACZ,OAEqB,WAA5BA,EAAEyG,GAAMC,IAAI,cACZH,EAASI,SAAS3G,EAAEyG,GAAMC,IAAI,UAAW,KAAOH,MAGjDA,EAOX,QAASK,KACL,MAAO5G,GAAE,qBAAqBoG,MAC1BT,KAAM,iBAAmBkB,MAC1BC,OA5XP,GAAIxB,GAAgC,mBAAX5C,QAAyBA,OAAO4C,WAA+B,mBAAXhD,GAAyBA,EAAOgD,WAAa,KACtHlF,EAAWpB,EAAQ,aAEvBsG,GAAWC,UACX,IAAIsB,GAAc,EACdvF,EAAM,CAwCVf,GAAOwG,UAAUjB,MAAQ,WACrB9D,KAAKgF,KAAOhH,EAAE,iBAAiBoG,MAC3Ba,OAAQ,OACRC,QAAS,sBACTtB,OAAQ5D,KAAK0D,SAASE,SAE1B5D,KAAKgF,KAAKG,OAAOnB,EAAahE,KAAK0D,SAASvE,OAE5Ca,KAAKoF,MAAQpH,EAAE,mBAAmBoG,MAC9BrD,KAAM,OACN4C,KAAM3D,KAAK0D,SAASC,KACpBzF,OAAQ8B,KAAK0D,SAASxF,QAAU,GAChC2F,WAAY7D,KAAK0D,SAASG,UAE9B,IAAIwB,GAAWrH,EAAEgC,KAAK0D,SAAStE,SAC3BkG,EAAaD,EAASC,WAAcD,EAASC,aAAeD,EAAS,GAAGE,YACxEC,EAAcH,EAASG,YAAeH,EAASG,cAAgBH,EAAS,GAAGI,YAC/EzF,MAAKoF,MAAMhB,KAAK,aAAa,GAAMM,KAC/BgB,SAAU,WACVC,KAAM,EACNC,IAAK,EACLC,QAAS,EACTC,QAAS,EACTC,OAAQ,UACR5D,MAAOmD,EACPlD,OAAQoD,IAEZxF,KAAKgF,KAAKG,OAAOnF,KAAKoF,OACtBpF,KAAKgF,KAAKN,KACNgB,SAAU,WACVE,IAAKP,EAASW,SAASJ,IACvBD,KAAMN,EAASW,SAASL,KACxBxD,MAAOmD,EACPlD,OAAQoD,EACRS,SAAU,SACV1B,OAAQF,EAAWgB,GAAY,KAChCa,SAAS,SAMhB3H,EAAOwG,UAAUhB,KAAO,WACpB,GAAIP,GAAOxD,KACPqF,EAAWrH,EAAEwF,EAAKE,SAAStE,SAC3BkG,EAAaD,EAASC,WAAcD,EAASC,aAAeD,EAAS,GAAGE,YACxEC,EAAcH,EAASG,YAAeH,EAASG,cAAgBH,EAAS,GAAGI,YAC/EJ,GAASc,WAAW,WAChB3C,EAAKwB,KAAKN,KACNkB,IAAKP,EAASW,SAASJ,IACvBD,KAAMN,EAASW,SAASL,KACxBxD,MAAOmD,EACPlD,OAAQoD,MAGhBhC,EAAK4C,aAMT7H,EAAOwG,UAAUqB,UAAY,WACzB,GAAI5C,GAAOxD,IACXwD,GAAK6C,SAEL7C,EAAK4B,MAAMkB,GAAG,SAAU,SAAS9J,GAG7BgH,EAAK6C,MAAQrG,KAAKqG,SACd1C,KAAMnH,EAAE8E,OAAO4C,MAAMrF,MAAM,MAAM0H,QAErC/C,EAAKgD,KAAOxI,EAAEiG,IAAIT,EAAK6C,MAAO,WAC1B,MAAO/G,OAEPkE,EAAKE,SAAS3D,OACdyD,EAAKE,SAAS3D,OAAOxC,KAAKiG,EAAMA,EAAK6C,MAAO7C,EAAKgD,MAEjDhD,EAAKvD,YAWjB1B,EAAOwG,UAAU9E,OAAS,WACtB,GAAIwG,GAAU,IAOd,OALIA,GADA/F,OAAOgG,SACG1G,KAAK2G,WAAW3G,KAAKqG,MAAOrG,KAAKwG,MAEjCxG,KAAK4G,WAAW5G,KAAKwG,KAAK,IAExCxG,KAAK6G,eACEJ,GAWXlI,EAAOwG,UAAU4B,WAAa,SAAUN,EAAOG,GAC3C,GAAIhD,GAAOxD,KAGP8G,IA+DJ,OA9DA9I,GAAEgB,KAAKqH,EAAO,SAAUpH,EAAOsB,GAC3B,GAAIkG,GAAUrI,EAASmC,EAAMiD,EAAKE,SAAStF,UAAU,SAAS,WAG1D,MAAOmC,KACRzC,KAAK,SAAUsD,GAGdoC,EAAK4B,MAAMhB,KAAK,YAAY,EAC5B,IAAIY,GAAO,GAAI0B,UAASlD,EAAKwB,KAAK+B,IAAI,GAGtC,OAFA/B,GAAKG,OAAO3B,EAAKE,SAASC,KAAMvC,EAAMb,EAAKoD,MAC3CH,EAAK4B,MAAMhB,KAAK,YAAY,GACrB,GAAI5D,SAAQ,SAAUC,EAASwB,GAClCjE,EAAEgJ,MACErI,IAAK6E,EAAKE,SAASE,OACnB7C,KAAM,OACNkG,aAAa,EACbC,aAAa,EACb/H,KAAM6F,EACN7G,QAASqF,EAAKE,SAASvF,QACvBgJ,IAAK,WACD,GAAIA,GAAMnJ,EAAEoJ,aAAaD,KAYzB,OAXIA,GAAIE,QAAU7D,EAAKE,SAAS9D,UAC5BuH,EAAIE,OAAOC,iBAAiB,WAAY,SAASnG,GAC7C,GAAIoG,GAAU,EACV7B,EAAWvE,EAAMqG,QAAUrG,EAAMuE,SACjC+B,EAAQtG,EAAMsG,KACdtG,GAAMuG,mBACNH,EAAUjF,KAAKqF,KAAKjC,EAAW+B,EAAQ,MAE3CjE,EAAKE,SAAS9D,SAAS8F,EAAU+B,EAAOF,EAAS/D,EAAKgD,KAAKvH,MAC5D,GAEAkI,GAEX9H,QAAS,SAAUF,GACfsB,EAAQtB,IAEZK,MAAO,SAAU2H,EAAKS,EAAYC,GAC1BA,IACAA,EAAc,IAAMA,EAExB,IAAInI,GAAU,iBAAmBkI,EAAaC,CAC9C5F,GAAO,GAAI9E,OAAMuC,WAI9B5B,KAAK,SAAUqB,GAGVqE,EAAKE,SAASrE,SACdmE,EAAKE,SAASrE,QAAQF,EAAMqH,EAAKvH,KAEtC,SAAUU,GAGL6D,EAAKE,SAASlE,OACdgE,EAAKE,SAASlE,MAAMG,EAAK6G,EAAKvH,KAGtC6H,GAAWgB,KAAKrB,KAEbjG,QAAQuH,IAAIjB,IASvBvI,EAAOwG,UAAU6B,WAAa,SAAUtH,GACpC,GAAIkE,GAAOxD,IAEX,OAAO,IAAIQ,SAAQ,SAAUC,EAASwB,GAGlCuB,EAAKwE,OAASpD,IACdpB,EAAKwB,KAAKZ,KAAK,SAAUZ,EAAKwE,OAAO5D,KAAK,SAC1CpG,EAAE,QAAQmH,OAAO3B,EAAKwE,QAGtBxE,EAAKwE,OAAOC,IAAI,OAAQ,WACpBC,aAAaC,GAGbnK,EAAE,6CACGkI,SAAS1C,EAAKwB,MACdoD,QACL,IAAI3J,GAAWT,EAAEqK,KAAKrK,EAAEgC,MAAMsI,WAAWC,KAAK,QAAQC,OACtD/H,GAAQhC,KAEZ+E,EAAKwB,KAAK/E,QAGV,IAAIkI,GAAQM,WAAW,WACnBxG,EAAO,GAAI9E,OAAM,2BAClBqG,EAAKE,SAASvF,WAClBL,KAAK,SAAUqB,GAGVqE,EAAKE,SAASrE,SACdmE,EAAKE,SAASrE,QAAQF,EAAMG,IAEjC,SAAUK,GAGL6D,EAAKE,SAASlE,OACdgE,EAAKE,SAASlE,MAAMG,EAAKL,KAE9BxB,KAAK,WAGJ0F,EAAKwE,OAAOI,YAQpB7J,EAAOwG,UAAU8B,aAAe,WAC5B,GAAI6B,GAAW1I,KAAKoF,MAAMuD,OAC1B3I,MAAKoF,MAAMwD,OAAOF,GAClB1I,KAAKoF,MAAMyD,IAAI,UACf7I,KAAKoF,MAAMgD,SACXpI,KAAKoF,MAAQsD,EACb1I,KAAKoG,aAQT7H,EAAOwG,UAAUhF,OAAS,SAAS+I,GAC/B,MAAKA,IAGL9I,KAAK0D,SAAS3D,OAAS+I,EAChB9I,MAHIA,MAWfzB,EAAOwG,UAAU1F,QAAU,SAASyJ,GAChC,MAAKA,IAGL9I,KAAK0D,SAASrE,QAAUyJ,EACjB9I,MAHIA,MAWfzB,EAAOwG,UAAUvF,MAAQ,SAASsJ,GAC9B,MAAKA,IAGL9I,KAAK0D,SAASlE,MAAQsJ,EACf9I,MAHIA,MAWfzB,EAAOwG,UAAUnF,SAAW,SAASkJ,GACjC,MAAKA,IAGL9I,KAAK0D,SAAS9D,SAAWkJ,EAClB9I,MAHIA,MAkDfK,EAAO/C,QAAUiB,IAEdhB,KAAKyC,KAAuB,mBAAXM,QAAyBA,OAAyB,mBAATkD,MAAuBA,KAAyB,mBAAX9C,QAAyBA,aACxHqI,aAAa,IAAIC,GAAG,SAAShM,EAAQqD,IACxC,SAAWC,GACX,YAaA,SAAS2I,GAAQtK,EAAKQ,GAClB,MAAO,IAAIqB,SAAQ,SAAUC,EAASwB,GAClCjE,EAAEgJ,MACErI,IAAKA,EACLQ,KAAMA,EACN+J,SAAU,OACV7J,QAAS,SAAUZ,GACXA,EAASY,QACToB,EAAQhC,EAASiB,SAEjBuC,EAAO,GAAI9E,OAAM,wBAA0BsB,EAASiB,WAG5DF,MAAO,SAAU2H,EAAKS,EAAYC,GAC1BA,IACAA,EAAc,IAAMA,GAExB5F,EAAO,GAAI9E,OAAM,wBAA0ByK,EAAaC,SAYxE,QAASsB,GAAUpI,EAAMpD,GACrB,GAAa,UAAToD,EAAkB,CAClBL,OAAO0I,SAASC,OAAS3I,OAAO0I,SAASC,QACrC3I,OAAO0I,SAASE,SAAW,KAAO5I,OAAO0I,SAASG,UACjD7I,OAAO0I,SAASI,KAAO,IAAM9I,OAAO0I,SAASI,KAAM,GACxD,IAAI7K,GAAM+B,OAAO0I,SAASC,OAAS,0BAC/BI,GACA9L,OAAQA,EACR+L,aAAchJ,OAAO0I,SAASC,OAAS,0BAEvC3I,QAAOgG,gBACA+C,GAAM,aAEjB,IAAIE,GAAQjJ,OAAO/C,EAAOiM,cAC1B,OAAID,GACOnJ,QAAQC,SACXmD,OAAQ+F,EAAME,UACd1K,KAAMwK,EAAMG,aACZnG,KAAMgG,EAAMI,UAGTd,EAAQtK,EAAK8K,GAAO3L,KAAK,SAAUW,GAEtC,MADAiC,QAAO/C,EAAOiM,eAAiBnL,GAE3BmF,OAAQnF,EAASoL,UACjB1K,KAAMV,EAASqL,aACfnG,KAAMlF,EAASsL,WAK/B,MAAOvJ,SAAQyB,OAAO,GAAI9E,OAAM,4CAvEpC,GAAImG,GAAgC,mBAAX5C,QAAyBA,OAAO4C,WAA+B,mBAAXhD,GAAyBA,EAAOgD,WAAa,IAC1HA,GAAWC,WAyEXlD,EAAO/C,QAAU6L,IAEd5L,KAAKyC,KAAuB,mBAAXM,QAAyBA,OAAyB,mBAATkD,MAAuBA,KAAyB,mBAAX9C,QAAyBA,qBAChH","file":"image_upload.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar Upload = require('./lib/upload')\nvar vendorConfig = require('./lib/vendor_config')\n\n/**\n * imageUpload function\n * @param  {string} vendor  'upyun/qiniu/upyun_im'\n * @param  {Object} options upload config\n * @return {Promise}        promise resolve upload object, reject any error (mostly: server_config error: xxxx)\n */\nfunction imageUpload(vendor, options) {\n    if (typeof vendor === 'object') {\n        options = vendor\n        vendor = 'upyun'\n    }\n    vendor = vendor || 'upyun'\n    if (typeof options !== 'object') {\n        options = {}\n    }\n    return vendorConfig('image', vendor).then(function (config) {\n        $.extend(config, {\n            accept: 'image/*',\n            timeout: 5000,\n            compress: {\n                max_width: 300,\n                max_height: 300\n            }\n        }, options)\n        return new Upload(config)\n    })\n}\n\n/**\n * get uploaded image Thumbnail url\n * @param  {Object} response reponse object\n * @param  {string} suffix   path suffix(180x180)\n * @param  {string} vendor   'upyun/qiniu/upyun_im'\n * @return {string}          Thumbnail url\n */\ngetThumbnailUrl = function (vendor, response, suffix) {\n    vendor = vendor || 'upyun'\n    var url = response.url || response.upload_ret.url\n    url = url.split('#')[0]\n    suffix = suffix ? ('_' + suffix) : '_sq'\n    if (vendor === 'upyun') {\n        return 'http://img' + (url.charCodeAt(1) % 3 + 4) + '.baixing.net' + url + suffix\n    } else if (vendor === 'qiniu') {\n        return 'http://img7.baixing.net/' + url + suffix\n    }\n}\n\n/**\n * get url for db store\n * @param  {Object} response reponse object\n * @param  {String} vendor   'upyun/qiniu/upyun_im'\n * @return {string}          url\n */\ngetUrl = function (vendor, response) {\n    vendor = vendor || 'upyun'\n    var url = response.url || response.upload_ret.url\n    url = url.split('#')[0]\n    var suffix = ''\n    if (vendor === 'upyun' || vendor === 'upyun_im') {\n        suffix = '#up'\n    } else if (vendor === 'qiniu') {\n        suffix = '#qn'\n    }\n    return url + suffix\n}\n\n// image-upload init via data-API\n$(function () {\n    $('[data-image-upload]').each(function (index, element) {\n        var vendor = $(element).data('vendor')\n        var accept = $(element).data('accept')\n        var suffix = $(element).data('suffix')\n        imageUpload(vendor, {\n            trigger: $(element),\n            accept: accept,\n            success: function (response, uid) {\n                if (typeof response === 'string') {\n                    response = $.parseJSON(response)\n                }\n                if (response.code === 200 || (vendor === 'qiniu' && !response.error)) {\n                    var thumbnailUrl = getThumbnailUrl(vendor, response, suffix)\n                    var url = getUrl(vendor, response)\n                    $(element).trigger('imageUploadSuccess', [thumbnailUrl, url, uid])\n                } else {\n                    $(element).trigger('imageUploadError', [response.message || response.error, uid])\n                }\n            },\n            error: function (err, uid) {\n                if (err.message === 'upload error: timeout') {\n                    $(element).trigger('imageUploadTimeout', [uid])\n                }\n                $(element).trigger('imageUploadError', [err.message, uid])\n            },\n            progress: function (position, total, percent, uid) {\n                $(element).trigger('imageUploadProgress', [].slice.call(arguments, 0))\n            },\n            select: function (files, uids) {\n                $(element).trigger('imageUploadSelect', [].slice.call(arguments, 0))\n                this.submit()\n            }\n        })['catch'](function (err) {\n            $(element).trigger('imageUploadError', err.message)\n        })\n    })\n})\n\n\n},{\"./lib/upload\":3,\"./lib/vendor_config\":4}],2:[function(require,module,exports){\n(function (global){\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nES6Promise.polyfill()\n\n/**\n * compress (now only support image)\n * @param  {File}    file\n * @param  {object}  options {max_width, max_height, quality}\n * @return {Promise}\n */\nfunction compress(file, options) {\n\n    // do not need to compress\n    if (options === false) {\n        return Promise.resolve(file)\n    }\n\n    // check File API support\n    if (!window.File || !window.FileReader || !window.URL) {\n        return Promise.reject(new Error('File API not support'))\n    }\n\n    // check file param\n    if (!(file instanceof File)) {\n        return Promise.reject(new Error('file invalid'))\n    }\n\n    // can not compress\n    if (!(/image/i).test(file.type)) {\n        return Promise.reject(new Error('file is not image'))\n    }\n    if (typeof options !== 'object') {\n        options = {}\n    }\n    return new Promise(function (resolve, reject) {\n\n        // read the files\n        var reader = new FileReader()\n        reader.readAsArrayBuffer(file)\n        reader.onload = function (event) {\n\n            // blob stuff\n            var blob = new Blob([event.target.result])\n            window.URL = window.URL || window.webkitURL\n            var blobURL = window.URL.createObjectURL(blob)\n\n            // helper Image object\n            var image = new Image()\n            image.src = blobURL\n            image.onload = function() {\n\n                // send it to canvas\n                var dataURI = resize(image, file.type, options)\n                var blob = dataURItoBlob(dataURI)\n                resolve(blob)\n            }\n        }\n    })\n}\n\n/**\n * resize Image through canvas\n * @param  {Image}  img      DOM Element\n * @param  {string} type     MIME-STRING\n * @param  {number} options  {max_width, max_height, quality}\n * @return {string}          base64/URLEncoded data\n */\nfunction resize(img, type, options) {\n    var width = img.width\n    var height = img.height\n    var max_width = options.max_width || width\n    var max_height = options.max_height || height\n    var quality = options.quality || null\n\n    // calculate the width and height, constraining the proportions\n    if (width > height) {\n        if (width > max_width) {\n            height = Math.round(height *= max_width / width)\n            width = max_width\n        }\n    } else {\n        if (height > max_height) {\n            width = Math.round(width *= max_height / height)\n            height = max_height\n        }\n    }\n\n    // resize the canvas and draw the image data into it\n    var canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    var ctx = canvas.getContext(\"2d\")\n    ctx.drawImage(img, 0, 0, width, height)\n    return canvas.toDataURL(type, quality)\n}\n\n/**\n * convert base64/URLEncoded data component to raw binary data held in a string\n * @param  {string} dataURI base64/URLEncoded data\n * @return {string}         raw binary data\n */\nfunction dataURItoBlob(dataURI) {\n    var byteString = ''\n    if (dataURI.split(',')[0].indexOf('base64') >= 0) {\n        byteString = atob(dataURI.split(',')[1])\n    }\n    else {\n        byteString = unescape(dataURI.split(',')[1])\n    }\n\n    // separate out the mime component\n    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0]\n\n    // write the bytes of the string to a typed array\n    var ia = new Uint8Array(byteString.length)\n    for (var i = 0; i < byteString.length; i++) {\n        ia[i] = byteString.charCodeAt(i)\n    }\n    return new Blob([ia], {type: mimeString})\n}\n\nmodule.exports = compress\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],3:[function(require,module,exports){\n(function (global){\n/*\n * Base on arale/upload\n * error message: 'upload error: xxxx' (mostly)\n * error will call settings.error function\n */\n\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nvar compress = require('./compress')\n\nES6Promise.polyfill()\nvar iframeCount = 0\nvar uid = 0\n\n/**\n * Upload constructor\n * @param {Object} options config\n */\nfunction Upload(options) {\n    if (!(this instanceof Upload)) {\n        return new Upload(options)\n    }\n    if (typeof options !== 'object') {\n        options = {}\n    }\n    var settings = {\n        trigger: null,\n        name: 'file',\n        action: '/upload',\n        accept: null,\n        data: null,\n        multiple: true,\n        select: null,\n        error: null,\n        success: null,\n        progress: null,\n        compress: false,\n        timeout: 10000\n    }\n    $.extend(settings, options)\n    this.settings = settings\n    if (!$(this.settings.trigger).length) {\n        throw Error('config error: trigger invalid')\n    }\n\n    this.setup()\n    this.bind()\n}\n\n/**\n * init form that contains hidden data input and transparency file input\n */\nUpload.prototype.setup = function () {\n    this.form = $('<form></from>').prop({\n        method: 'post',\n        enctype: 'multipart/form-data',\n        action: this.settings.action\n    })\n    this.form.append(createInputs(this.settings.data))\n\n    this.input = $('<input></input>').prop({\n        type: 'file',\n        name: this.settings.name,\n        accept: this.settings.accept || '',\n        multiple: !!this.settings.multiple\n    })\n    var $trigger = $(this.settings.trigger)\n    var outerWidth = $trigger.outerWidth ?  $trigger.outerWidth() : $trigger[0].offsetWidth\n    var outerHeight = $trigger.outerHeight ?  $trigger.outerHeight() : $trigger[0].offsetHeight\n    this.input.prop('hidefocus', true).css({\n        position: 'absolute',\n        left: 0,\n        top: 0,\n        opacity: 0,\n        outline: 0,\n        cursor: 'pointer',\n        width: outerWidth,\n        height: outerHeight\n    })\n    this.form.append(this.input)\n    this.form.css({\n        position: 'absolute',\n        top: $trigger.offset().top,\n        left: $trigger.offset().left,\n        width: outerWidth,\n        height: outerHeight,\n        overflow: 'hidden',\n        zIndex: findzIndex($trigger) + 10\n    }).appendTo('body')\n}\n\n/**\n * bind the trigger element to form\n */\nUpload.prototype.bind = function () {\n    var self = this\n    var $trigger = $(self.settings.trigger)\n    var outerWidth = $trigger.outerWidth ?  $trigger.outerWidth() : $trigger[0].offsetWidth\n    var outerHeight = $trigger.outerHeight ?  $trigger.outerHeight() : $trigger[0].offsetHeight\n    $trigger.mouseenter(function () {\n        self.form.css({\n            top: $trigger.offset().top,\n            left: $trigger.offset().left,\n            width: outerWidth,\n            height: outerHeight\n        })\n    })\n    self.bindInput()\n}\n\n/**\n * handle file input change event\n */\nUpload.prototype.bindInput = function () {\n    var self = this\n    self.files = []\n\n    self.input.on('change', function(e) {\n\n        // ie9- don't support FileList Object\n        self.files = this.files || [{\n            name: e.target.value.split('\\\\').pop()\n        }]\n        self.uids = $.map(self.files, function (file, index) {\n            return uid++\n        })\n        if (self.settings.select) {\n            self.settings.select.call(self, self.files, self.uids)\n        } else {\n            self.submit()\n        }\n    })\n}\n\n/**\n * upload file to server\n * use ajax or form\n * refresh file input when trigger submit\n * @return {Promise}   upload completed primise\n */\nUpload.prototype.submit = function () {\n    var promise = null\n    if (window.FormData) {\n        promise = this.ajaxSubmit(this.files, this.uids)\n    } else {\n        promise = this.formSubmit(this.uids[0])\n    }\n    this.refreshInput()\n    return promise\n}\n\n/**\n * upload file by ajax\n * it will be compressed\n * success or error will trigger callback function\n * @param  {Array}   files   upload files\n * @param  {Array}   uids    the files's uids\n * @return {Promise}         upload completed promise\n */\nUpload.prototype.ajaxSubmit = function (files, uids) {\n    var self = this\n\n    // upyun server do not support multiple files upload\n    var promiseArr = []\n    $.each(files, function (index, file) {\n        var promise = compress(file, self.settings.compress)['catch'](function (err) {\n\n            // compress error then go on uploading\n            return file\n        }).then(function (blob) {\n\n            // add data and file\n            self.input.prop('disabled', true)\n            var form = new FormData(self.form.get(0))\n            form.append(self.settings.name, blob, file.name)\n            self.input.prop('disabled', false)\n            return new Promise(function (resolve, reject) {\n                $.ajax({\n                    url: self.settings.action,\n                    type: 'post',\n                    processData: false,\n                    contentType: false,\n                    data: form,\n                    timeout: self.settings.timeout,\n                    xhr: function () {\n                        var xhr = $.ajaxSettings.xhr()\n                        if (xhr.upload && self.settings.progress) {\n                            xhr.upload.addEventListener('progress', function(event) {\n                                var percent = 0\n                                var position = event.loaded || event.position\n                                var total = event.total\n                                if (event.lengthComputable) {\n                                    percent = Math.ceil(position / total * 100)\n                                }\n                                self.settings.progress(position, total, percent, self.uids[index])\n                            }, false)\n                        }\n                        return xhr\n                    },\n                    success: function (data) {\n                        resolve(data)\n                    },\n                    error: function (xhr, textStatus, errorThrown) {\n                        if (errorThrown) {\n                            errorThrown = ' ' + errorThrown\n                        }\n                        var message = 'upload error: ' + textStatus + errorThrown\n                        reject(new Error(message))\n                    }\n                })\n            })\n        }).then(function (data) {\n\n            // upload success\n            if (self.settings.success) {\n                self.settings.success(data, uids[index])\n            }\n        }, function (err) {\n\n            // upload error\n            if (self.settings.error) {\n                self.settings.error(err, uids[index])\n            }\n        })\n        promiseArr.push(promise)\n    })\n    return Promise.all(promiseArr)\n}\n\n/**\n * upload file by form submit\n * success or error will trigger callback function\n * @param  {number}   uid  file uid\n * @return {Promise}       upload completed promise\n */\nUpload.prototype.formSubmit = function (uid) {\n    var self = this\n\n    return new Promise(function (resolve, reject) {\n\n        // combine form and iframe\n        self.iframe = newIframe()\n        self.form.prop('target', self.iframe.prop('name'))\n        $('body').append(self.iframe)\n\n        // bind iframe load event\n        self.iframe.one('load', function () {\n            clearTimeout(timer)\n\n            // Fix for IE endless progress bar activity bug (happens on form submits to iframe targets)\n            $('<iframe src=\"javascript:false;\"></iframe>')\n                .appendTo(self.form)\n                .remove()\n            var response = $.trim($(this).contents().find(\"body\").html())\n            resolve(response)\n        })\n        self.form.submit()\n\n        // add timer\n        var timer = setTimeout(function () {\n            reject(new Error('upload error: timeout'))\n        }, self.settings.timeout)\n    }).then(function (data) {\n\n        // upload success\n        if (self.settings.success) {\n            self.settings.success(data, uid)\n        }\n    }, function (err) {\n\n        // upload error\n        if (self.settings.error) {\n            self.settings.error(err, uid)\n        }\n    }).then(function () {\n\n        // upload finished then remove iframe\n        self.iframe.remove()\n    })\n}\n\n/**\n * update the input element\n * or the same file can not upload\n */\nUpload.prototype.refreshInput = function () {\n    var newInput = this.input.clone()\n    this.input.before(newInput)\n    this.input.off('change')\n    this.input.remove()\n    this.input = newInput\n    this.bindInput()\n}\n\n/**\n * set settings.select\n * @param  {Function} callback override settings.select\n * @return {Object}            upload object\n */\nUpload.prototype.select = function(callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.select = callback\n    return this\n}\n\n/**\n * set settings.success\n * @param  {Function} callback override settings.success\n * @return {Object}            upload object\n */\nUpload.prototype.success = function(callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.success = callback\n    return this\n}\n\n/**\n * set settings.error\n * @param  {Function} callback override settings.error\n * @return {Object}            upload object\n */\nUpload.prototype.error = function(callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.error = callback\n    return this\n}\n\n/**\n * set settings.progress\n * @param  {Function} callback override settings.progress\n * @return {Object}            upload object\n */\nUpload.prototype.progress = function(callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.progress = callback\n    return this\n}\n\n/**\n * create hidden input for data\n * @param  {Object} data settings.data\n * @return {Array}       array of hidden input\n */\nfunction createInputs(data) {\n    if (!data) return []\n    return $.map(data, function (value, key) {\n        return $('<input></input>').prop({\n            type: 'hidden',\n            name: key,\n            value: value\n        })\n    })\n}\n\n/**\n * find the parents\n * @param  {jQueryElement} $node\n * @return {number}               parents max_zIndex\n */\nfunction findzIndex($node) {\n    var zIndex = 0\n    $.each($node.parents(), function (index, item) {\n        if (item === $('body')[0]) {\n            return false\n        }\n        if ($(item).css('position') !== 'static') {\n            zIndex = parseInt($(item).css('zIndex'), 10) || zIndex\n        }\n    })\n    return zIndex\n}\n\n/**\n * create new iframe when trigger form submit\n * @return {jQueryElement} iframe element of jQuery\n */\nfunction newIframe() {\n    return $('<iframe></iframe>').prop({\n        name: 'iframe-Upload-' + iframeCount++\n    }).hide()\n}\n\nmodule.exports = Upload\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./compress\":2}],4:[function(require,module,exports){\n(function (global){\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nES6Promise.polyfill()\n\n// err message: 'server_config error: xxxx'\n\n/**\n * get Json via ajax\n * @param  {string} url  the server url\n * @param  {Object} data query data\n * @return {Promise}     promise resolve message\n */\nfunction getJson(url, data) {\n    return new Promise(function (resolve, reject) {\n        $.ajax({\n            url: url,\n            data: data,\n            dataType: 'json',\n            success: function (response) {\n                if (response.success) {\n                    resolve(response.message)\n                } else {\n                    reject(new Error('server_config error: ' + response.message))\n                }\n            },\n            error: function (xhr, textStatus, errorThrown) {\n                if (errorThrown) {\n                    errorThrown = ' ' + errorThrown\n                }\n                reject(new Error('server_config error: ' + textStatus + errorThrown))\n            }\n        })\n    })\n}\n\n/**\n * get server config\n * @param  {string} type   'image/media'\n * @param  {string} vendor 'upyun/qiniu/upyun_im'\n * @return {Promise}        promise resolve server config\n */\nfunction getConfig(type, vendor) {\n    if (type === 'image') {\n        window.location.origin = window.location.origin ||\n            window.location.protocol + \"//\" + window.location.hostname +\n            (window.location.port ? ':' + window.location.port: '')\n        var url = window.location.origin + '/imageUpload/getConfig/'\n        var query = {\n            vendor: vendor,\n            'return-url': window.location.origin + '/imageUpload/getResult/'\n        }\n        if (window.FormData) {\n            delete query['return-url']\n        }\n        var cache = window[vendor.toUpperCase()]\n        if (cache) {\n            return Promise.resolve({\n                action: cache.uploadUrl,\n                data: cache.uploadParams,\n                name: cache.fileKey\n            })\n        } else {\n            return getJson(url, query).then(function (response) {\n                window[vendor.toUpperCase()] = response\n                return {\n                    action: response.uploadUrl,\n                    data: response.uploadParams,\n                    name: response.fileKey\n                }\n            })\n        }\n    }\n    return Promise.reject(new Error('server_config error: ' + 'media type invalid'))\n}\n\nmodule.exports = getConfig\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}]},{},[1]);\n"],"sourceRoot":"/source/"}