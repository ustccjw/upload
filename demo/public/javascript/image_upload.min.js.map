{"version":3,"sources":["image_upload.min.js"],"names":["e","exports","module","define","amd","f","window","global","self","imageUpload","t","n","r","s","o","u","a","require","i","Error","code","l","call","length",1,"vendor","options","vendorLib","getConfig","then","config","$","extend","accept","timeout","compress","max_width","max_height","Upload","getThumbnailUrl","response","suffix","url","upload_ret","split","charCodeAt","getUrl","each","index","element","data","trigger","success","uid","parseJSON","error","thumbnailUrl","message","err","indexOf","progress","arguments","select","this","submit","./lib/upload","./lib/vendor",2,"file","Promise","resolve","File","FileReader","URL","test","type","reader","readAsArrayBuffer","onload","event","blob","Blob","target","result","webkitURL","blobURL","createObjectURL","image","Image","src","dataURI","resize","dataURItoBlob","reject","img","width","height","quality","Math","round","canvas","document","createElement","ctx","getContext","drawImage","toDataURL","byteString","atob","unescape","mimeString","ia","Uint8Array","ES6Promise","polyfill",3,"settings","name","action","multiple","setup","bind","createInputs","inputs","value","push","findzIndex","$node","parents","parentsUntil","zIndex","item","eq","css","parseInt","newIframe","iframeName","iframeCount","iframe","hide","prototype","form","append","input","setAttribute","$trigger","attr","position","top","right","opacity","outline","cursor","outerHeight","fontSize","max","offset","left","overflow","outerWidth","appendTo","mouseenter","bindInput","files","change","pop","uids","map","FormData","ajaxSubmit","formSubmit","promiseArr","promise","prop","get","ajax","processData","contentType","xhr","ajaxSettings","upload","addEventListener","percent","loaded","total","lengthComputable","ceil","textStatus","all","refreshInput","timer","one","clearTimeout","remove","trim","contents","find","html","setTimeout","newInput","clone","before","off","callback","./compress",4,"getJson","dataType","location","origin","protocol","hostname","port","query","return-url","uploadUrl","uploadParams","fileKey"],"mappings":"CAAC,SAASA,GAAG,GAAG,gBAAiBC,UAAS,mBAAoBC,QAAOA,OAAOD,QAAQD,QAAS,IAAG,kBAAmBG,SAAQA,OAAOC,IAAID,UAAUH,OAAO,CAAC,GAAIK,EAAE,oBAAoBC,QAAOD,EAAEC,OAAO,mBAAoBC,QAAOF,EAAEE,OAAO,mBAAoBC,QAAOH,EAAEG,MAAMH,EAAEI,YAAYT,MAAM,WAAqC,MAAO,SAAUA,GAAEU,EAAEC,EAAEC,GAAG,QAASC,GAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,GAAIE,GAAkB,kBAATC,UAAqBA,OAAQ,KAAIF,GAAGC,EAAE,MAAOA,GAAEF,GAAE,EAAI,IAAGI,EAAE,MAAOA,GAAEJ,GAAE,EAAI,IAAIT,GAAE,GAAIc,OAAM,uBAAuBL,EAAE,IAAK,MAAMT,GAAEe,KAAK,mBAAmBf,EAAE,GAAIgB,GAAEV,EAAEG,IAAIb,WAAYS,GAAEI,GAAG,GAAGQ,KAAKD,EAAEpB,QAAQ,SAASD,GAAG,GAAIW,GAAED,EAAEI,GAAG,GAAGd,EAAG,OAAOa,GAAEF,EAAEA,EAAEX,IAAIqB,EAAEA,EAAEpB,QAAQD,EAAEU,EAAEC,EAAEC,GAAG,MAAOD,GAAEG,GAAGb,QAAkD,IAAI,GAA1CiB,GAAkB,kBAATD,UAAqBA,QAAgBH,EAAE,EAAEA,EAAEF,EAAEW,OAAOT,IAAID,EAAED,EAAEE,GAAI,OAAOD,KAAKW,GAAG,SAASP,EAAQf,GAUzxB,QAASO,GAAYgB,EAAQC,GASzB,MARsB,gBAAXD,KACPC,EAAUD,EACVA,EAAS,SAEbA,EAASA,GAAU,QACI,gBAAZC,KACPA,MAEGC,EAAUC,UAAU,QAASH,GAAQI,KAAK,SAAUC,GASvD,MARAC,GAAEC,OAAOF,GACLG,OAAQ,UACRC,QAAS,IACTC,UACIC,UAAW,IACXC,WAAY,MAEjBX,GACI,GAAIY,GAAOR,KA3B1B,GAAIQ,GAASrB,EAAQ,gBACjBU,EAAYV,EAAQ,eAqCxBsB,iBAAkB,SAAUd,EAAQe,EAAUC,GAC1ChB,EAASA,GAAU,OACnB,IAAIiB,GAAMF,EAASE,KAAOF,EAASG,WAAWD,GAG9C,OAFAA,GAAMA,EAAIE,MAAM,KAAK,GACrBH,EAASA,EAAU,IAAMA,EAAU,MACpB,UAAXhB,EACO,cAAgBiB,EAAIG,WAAW,GAAK,EAAI,GAAK,eAAiBH,EAAMD,EACzD,UAAXhB,EACA,2BAA6BiB,EAAMD,EADvC,QAWXK,OAAS,SAAUrB,EAAQe,GACvBf,EAASA,GAAU,OACnB,IAAIiB,GAAMF,EAASE,KAAOF,EAASG,WAAWD,GAC9CA,GAAMA,EAAIE,MAAM,KAAK,EACrB,IAAIH,GAAS,EAMb,OALe,UAAXhB,GAAiC,aAAXA,EACtBgB,EAAS,MACS,UAAXhB,IACPgB,EAAS,OAENC,EAAMD,GAGjBvC,EAAOD,QAAUQ,EAGjBsB,EAAE,WACEA,EAAE,uBAAuBgB,KAAK,SAAUC,EAAOC,GAC3C,GAAIxB,GAASM,EAAEkB,GAASC,KAAK,UACzBT,EAASV,EAAEkB,GAASC,KAAK,SAC7BzC,GAAYgB,GACR0B,QAASpB,EAAEkB,GACXG,QAAS,SAAUZ,EAAUa,GAIzB,GAHwB,gBAAbb,KACPA,EAAWT,EAAEuB,UAAUd,IAEL,MAAlBA,EAASpB,MAA4B,UAAXK,IAAuBe,EAASe,MAAQ,CAClE,GAAIC,GAAejB,gBAAgBd,EAAQe,EAAUC,GACjDC,EAAMI,OAAOrB,EAAQe,EACzBT,GAAEkB,GAASE,QAAQ,sBAAuBK,EAAcd,EAAKW,QAE7DtB,GAAEkB,GAASE,QAAQ,oBAAqBX,EAASiB,SAAWjB,EAASe,MAAOF,KAGpFE,MAAO,SAAUG,EAAKL,GAClB,MAA8C,KAA1CK,EAAID,QAAQE,QAAQ,kBAGJ,0BAAhBD,EAAID,YACJ1B,GAAEkB,GAASE,QAAQ,sBAAuBE,QAG9CtB,GAAEkB,GAASE,QAAQ,oBAAqBO,EAAID,QAASJ,IAPrD,QASJO,SAAU,WACN7B,EAAEkB,GAASE,QAAQ,sBAAuBU,YAE9CC,OAAQ,WACJ/B,EAAEkB,GAASE,QAAQ,oBAAqBU,WACxCE,KAAKC,YAEV,SAAS,SAAUN,GAClB3B,EAAEkB,GAASE,QAAQ,mBAAoBO,EAAID,iBAMpDQ,eAAe,EAAEC,eAAe,IAAIC,GAAG,SAASlD,EAAQf,IAC3D,SAAWK,GACX,YAaA,SAAS4B,GAASiC,EAAM1C,GAGpB,MAAIA,MAAY,EACL2C,QAAQC,QAAQF,GAItB9D,OAAOiE,MAASjE,OAAOkE,YAAelE,OAAOmE,IAK5CL,YAAgBG,MAKjB,SAAWG,KAAKN,EAAKO,OAGH,gBAAZjD,KACPA,MAEG,GAAI2C,SAAQ,SAAUC,GAGzB,GAAIM,GAAS,GAAIJ,WACjBI,GAAOC,kBAAkBT,GACzBQ,EAAOE,OAAS,SAAUC,GAGtB,GAAIC,GAAO,GAAIC,OAAMF,EAAMG,OAAOC,QAClC7E,QAAOmE,IAAMnE,OAAOmE,KAAOnE,OAAO8E,SAClC,IAAIC,GAAU/E,OAAOmE,IAAIa,gBAAgBN,GAGrCO,EAAQ,GAAIC,MAChBD,GAAME,IAAMJ,EACZE,EAAMT,OAAS,WAGX,GAAIY,GAAUC,EAAOJ,EAAOnB,EAAKO,KAAMjD,GACnCsD,EAAOY,EAAcF,EACzBpB,GAAQU,QAzBTX,QAAQwB,OAAO,GAAI1E,OAAM,sBALzBkD,QAAQwB,OAAO,GAAI1E,OAAM,iBALzBkD,QAAQwB,OAAO,GAAI1E,OAAM,yBAgDxC,QAASwE,GAAOG,EAAKnB,EAAMjD,GACvB,GAAIqE,GAAQD,EAAIC,MACZC,EAASF,EAAIE,OACb5D,EAAYV,EAAQU,WAAa2D,EACjC1D,EAAaX,EAAQW,YAAc2D,EACnCC,EAAUvE,EAAQuE,SAAW,IAG7BF,GAAQC,EACJD,EAAQ3D,IACR4D,EAASE,KAAKC,MAAMH,GAAU5D,EAAY2D,GAC1CA,EAAQ3D,GAGR4D,EAAS3D,IACT0D,EAAQG,KAAKC,MAAMJ,GAAS1D,EAAa2D,GACzCA,EAAS3D,EAKjB,IAAI+D,GAASC,SAASC,cAAc,SACpCF,GAAOL,MAAQA,EACfK,EAAOJ,OAASA,CAChB,IAAIO,GAAMH,EAAOI,WAAW,KAE5B,OADAD,GAAIE,UAAUX,EAAK,EAAG,EAAGC,EAAOC,GACzBI,EAAOM,UAAU/B,EAAMsB,GAQlC,QAASL,GAAcF,GACnB,GAAIiB,GAAa,EAEbA,GADAjB,EAAQ9C,MAAM,KAAK,GAAGe,QAAQ,WAAa,EAC9BiD,KAAKlB,EAAQ9C,MAAM,KAAK,IAGxBiE,SAASnB,EAAQ9C,MAAM,KAAK,GAQ7C,KAAK,GAJDkE,GAAapB,EAAQ9C,MAAM,KAAK,GAAGA,MAAM,KAAK,GAAGA,MAAM,KAAK,GAG5DmE,EAAK,GAAIC,YAAWL,EAAWpF,QAC1BL,EAAI,EAAGA,EAAIyF,EAAWpF,OAAQL,IACnC6F,EAAG7F,GAAKyF,EAAW9D,WAAW3B,EAElC,OAAO,IAAI+D,OAAM8B,IAAMpC,KAAMmC,IAvHjC,GAAIG,GAAgC,mBAAX3G,QAAyBA,OAAO2G,WAA+B,mBAAX1G,GAAyBA,EAAO0G,WAAa,IACtHA,IACAA,EAAWC,WAwHfhH,EAAOD,QAAUkC,IAEdb,KAAKyC,KAAuB,mBAAXxD,QAAyBA,OAAyB,mBAATC,MAAuBA,KAAyB,mBAAXF,QAAyBA,gBACrH6G,GAAG,SAASlG,EAAQf,IAC1B,SAAWK,GAQX,YAeA,SAAS+B,GAAOZ,GACZ,KAAMqC,eAAgBzB,IAClB,MAAO,IAAIA,GAAOZ,EAEC,iBAAZA,KACPA,KAEJ,IAAI0F,IACAjE,QAAS,KACTkE,KAAM,OACNC,OAAQ,UACRrF,OAAQ,KACRiB,KAAM,KACNqE,UAAU,EACVzD,OAAQ,KACRP,MAAO,KACPH,QAAS,KACTQ,SAAU,KACVzB,UAAU,EACVD,QAAS,IAEbH,GAAEC,OAAOoF,EAAU1F,GACnBqC,KAAKqD,SAAWA,EAEhBrD,KAAKyD,QACLzD,KAAK0D,OAyST,QAASC,GAAaxE,GAClB,IAAKA,EAAM,QACX,IAAiBhC,GAAbyG,IACJ,KAAK,GAAIN,KAAQnE,GACbhC,EAAImF,SAASC,cAAc,SAC3BpF,EAAEyD,KAAO,SACTzD,EAAEmG,KAAOA,EACTnG,EAAE0G,MAAQ1E,EAAKmE,GACfM,EAAOE,KAAK3G,EAEhB,OAAOyG,GAQX,QAASG,GAAWC,GAGhB,IAAK,GAFDC,GAAUD,EAAME,aAAa,QAC7BC,EAAS,EACJhH,EAAI,EAAGA,EAAI8G,EAAQzG,OAAQL,IAAK,CACrC,GAAIiH,GAAOH,EAAQI,GAAGlH,EACO,YAAzBiH,EAAKE,IAAI,cACTH,EAASI,SAASH,EAAKE,IAAI,UAAW,KAAOH,GAGrD,MAAOA,GAOX,QAASK,KACL,GAAIC,GAAa,iBAAmBC,EAChCC,EAAS3G,EAAE,iBAAmByG,EAAa,QAAQG,MAEvD,OADAF,IAAe,EACRC,EArXX,GAAIzB,GAAgC,mBAAX3G,QAAyBA,OAAO2G,WAA+B,mBAAX1G,GAAyBA,EAAO0G,WAAa,KACtH9E,EAAWlB,EAAQ,aAEnBgG,IACAA,EAAWC,UAEf,IAAIuB,GAAc,EACdpF,EAAM,CAqCVf,GAAOsG,UAAUpB,MAAQ,WACrBzD,KAAK8E,KAAO9G,EACR,sEACyBgC,KAAKqD,SAASE,OAAS,OAGpD,IAAIpE,GAAOa,KAAKqD,SAASlE,IACzBa,MAAK8E,KAAKC,OAAOpB,EAAaxE,GAE9B,IAAI6F,GAAQ1C,SAASC,cAAc,QACnCyC,GAAMpE,KAAO,OACboE,EAAM1B,KAAOtD,KAAKqD,SAASC,KACvBtD,KAAKqD,SAASnF,SACd8G,EAAM9G,OAAS8B,KAAKqD,SAASnF,QAE7B8B,KAAKqD,SAASG,WACdwB,EAAMxB,UAAW,EACjBwB,EAAMC,aAAa,WAAY,aAEnCjF,KAAKgF,MAAQhH,EAAEgH,EAEf,IAAIE,GAAWlH,EAAEgC,KAAKqD,SAASjE,QAC/BY,MAAKgF,MAAMG,KAAK,aAAa,GAAMb,KAC/Bc,SAAU,WACVC,IAAK,EACLC,MAAO,EACPC,QAAS,EACTC,QAAS,EACTC,OAAQ,UACRxD,OAAQiD,EAASQ,cACjBC,SAAUxD,KAAKyD,IAAI,GAA6B,EAAzBV,EAASQ,iBAEpC1F,KAAK8E,KAAKC,OAAO/E,KAAKgF,OACtBhF,KAAK8E,KAAKR,KACNc,SAAU,WACVC,IAAKH,EAASW,SAASR,IACvBS,KAAMZ,EAASW,SAASC,KACxBC,SAAU,SACV/D,MAAOkD,EAASc,aAChB/D,OAAQiD,EAASQ,cACjBvB,OAAQJ,EAAWmB,GAAY,KAChCe,SAAS,SAMhB1H,EAAOsG,UAAUnB,KAAO,WACpB,GAAIjH,GAAOuD,KACPkF,EAAWlH,EAAEvB,EAAK4G,SAASjE,QAC/B8F,GAASgB,WAAW,WAChBzJ,EAAKqI,KAAKR,KACNe,IAAKH,EAASW,SAASR,IACvBS,KAAMZ,EAASW,SAASC,KACxB9D,MAAOkD,EAASc,aAChB/D,OAAQiD,EAASQ,kBAGzBjJ,EAAK0J,aAOT5H,EAAOsG,UAAUsB,UAAY,WACzB,GAAI1J,GAAOuD,IACXvD,GAAK2J,SACL3J,EAAKuI,MAAMqB,OAAO,SAASpK,GAGvBQ,EAAK2J,MAAQpG,KAAKoG,SACd9C,KAAMrH,EAAEkF,OAAO0C,MAAMhF,MAAM,MAAMyH,QAErC7J,EAAK8J,KAAOvI,EAAEwI,IAAI/J,EAAK2J,MAAO,WAC1B,MAAO9G,OAGP7C,EAAK4G,SAAStD,OACdtD,EAAK4G,SAAStD,OAAOxC,KAAKd,EAAMA,EAAK2J,MAAO3J,EAAK8J,MAEjD9J,EAAKwD,YASjB1B,EAAOsG,UAAU5E,OAAS,WAClB1D,OAAOkK,SACPzG,KAAK0G,aAEL1G,KAAK2G,cASbpI,EAAOsG,UAAU6B,WAAa,WAC1B,GAAIjK,GAAOuD,KAGPoG,EAAQ3J,EAAK2J,MACbQ,IACJ5I,GAAEgB,KAAKoH,EAAO,SAAUnH,EAAOoB,GAC3B,GAAIwG,GAAUzI,EAASiC,EAAM5D,EAAK4G,SAASjF,UAAU,SAAS,SAAUuB,GAGhElD,EAAK4G,SAAS7D,OACd/C,EAAK4G,SAAS7D,MAAM,GAAIpC,OAAM,mBAAqBuC,EAAID,SAAUjD,EAAK8J,KAAKtH,MAEhFnB,KAAK,SAAUmD,GAGdxE,EAAKuI,MAAM8B,KAAK,YAAY,EAC5B,IAAIhC,GAAO,GAAI2B,UAAShK,EAAKqI,KAAKiC,IAAI,GAMtC,OALAtK,GAAKuI,MAAM8B,KAAK,YAAY,GAG5B7F,EAAOA,GAAQZ,EACfyE,EAAKC,OAAOtI,EAAK4G,SAASC,KAAMrC,EAAMZ,EAAKiD,MACpC,GAAIhD,SAAQ,SAAUC,GACzBvC,EAAEgJ,MACErI,IAAKlC,EAAK4G,SAASE,OACnB3C,KAAM,OACNqG,aAAa,EACbC,aAAa,EACb/H,KAAM2F,EACN3G,QAAS1B,EAAK4G,SAASlF,QACvBgJ,IAAK,WACD,GAAIA,GAAMnJ,EAAEoJ,aAAaD,KAYzB,OAXIA,GAAIE,QAAU5K,EAAK4G,SAASxD,UAC5BsH,EAAIE,OAAOC,iBAAiB,WAAY,SAAStG,GAC7C,GAAIuG,GAAU,EACVnC,EAAWpE,EAAMwG,QAAUxG,EAAMoE,SACjCqC,EAAQzG,EAAMyG,KACdzG,GAAM0G,mBACNH,EAAUpF,KAAKwF,KAAKvC,EAAWqC,EAAQ,MAE3ChL,EAAK4G,SAASxD,SAASuF,EAAUqC,EAAOF,EAAS9K,EAAK8J,KAAKtH,MAC5D,GAEAkI,GAEX9H,QAAS,SAAUF,GACX1C,EAAK4G,SAAShE,SACd5C,EAAK4G,SAAShE,QAAQF,EAAM1C,EAAK8J,KAAKtH,IAE1CsB,KAEJf,MAAO,SAAU2H,EAAKS,GACdnL,EAAK4G,SAAS7D,OACd/C,EAAK4G,SAAS7D,MAAM,GAAIpC,OAAM,iBAAmBwK,GAAanL,EAAK8J,KAAKtH,IAE5EsB,UAKhBqG,GAAW9C,KAAK+C,KAIpBvG,QAAQuH,IAAIjB,GAAY9I,KAAK,WACzBrB,EAAKqL,kBAQbvJ,EAAOsG,UAAU8B,WAAa,WAC1B,GAAIlK,GAAOuD,IACXvD,GAAKkI,OAASH,IACd/H,EAAKqI,KAAKK,KAAK,SAAU1I,EAAKkI,OAAOQ,KAAK,SAC1C1I,EAAKkI,OAAOxF,KAAK,MAAO1C,EAAK8J,KAAK,IAClCvI,EAAE,QAAQ+G,OAAOtI,EAAKkI,OACtB,IAAIoD,GAAQ,IACZtL,GAAKkI,OAAOqD,IAAI,OAAQ,WACpBC,aAAaF,GAIb/J,EAAE,6CACGiI,SAASxJ,EAAKqI,MACdoD,QACL,IAAIzJ,GAAW,IACf,KACIA,EAAWT,EAAEmK,KAAKnK,EAAEgC,MAAMoI,WAAWC,KAAK,QAAQC,QACpD,MAAOrM,GACDQ,EAAK4G,SAAS7D,OACd/C,EAAK4G,SAAS7D,MAAM,GAAIpC,OAAM,8BAA+BY,EAAEgC,MAAMb,KAAK,QAEhF,QACmB,OAAbV,GAAqBhC,EAAK4G,SAAShE,SACnC5C,EAAK4G,SAAShE,QAAQZ,EAAUT,EAAEgC,MAAMb,KAAK,QAIjD1C,EAAKqL,eACL9J,EAAEgC,MAAMkI,YAGhBzL,EAAKqI,KAAK7E,SACV8H,EAAQQ,WAAW,WACX9L,EAAK4G,SAAS7D,OACd/C,EAAK4G,SAAS7D,MAAM,GAAIpC,OAAM,yBAA0BX,EAAKkI,OAAOxF,KAAK,QAI7E1C,EAAKqL,eACLrL,EAAKkI,OAAOuD,UACbzL,EAAK4G,SAASlF,UAOrBI,EAAOsG,UAAUiD,aAAe,WAC5B,GAAIU,GAAWxI,KAAKgF,MAAMyD,OAC1BzI,MAAKgF,MAAM0D,OAAOF,GAClBxI,KAAKgF,MAAM2D,IAAI,UACf3I,KAAKgF,MAAMkD,SACXlI,KAAKgF,MAAQwD,EACbxI,KAAKmG,aAQT5H,EAAOsG,UAAU9E,OAAS,SAAS6I,GAC/B,MAAKA,IAGL5I,KAAKqD,SAAStD,OAAS6I,EAChB5I,MAHIA,MAWfzB,EAAOsG,UAAUxF,QAAU,SAASuJ,GAChC,MAAKA,IAGL5I,KAAKqD,SAAShE,QAAUuJ,EACjB5I,MAHIA,MAWfzB,EAAOsG,UAAUrF,MAAQ,SAASoJ,GAC9B,MAAKA,IAGL5I,KAAKqD,SAAS7D,MAAQoJ,EACf5I,MAHIA,MAWfzB,EAAOsG,UAAUhF,SAAW,SAAS+I,GACjC,MAAKA,IAGL5I,KAAKqD,SAASxD,SAAW+I,EAClB5I,MAHIA,MAoDf7D,EAAOD,QAAUqC,IAEdhB,KAAKyC,KAAuB,mBAAXxD,QAAyBA,OAAyB,mBAATC,MAAuBA,KAAyB,mBAAXF,QAAyBA,aACxHsM,aAAa,IAAIC,GAAG,SAAS5L,EAAQf,EAAOD,IAC/C,SAAWM,GACX,YAEA,IAAI0G,GAAgC,mBAAX3G,QAAyBA,OAAO2G,WAA+B,mBAAX1G,GAAyBA,EAAO0G,WAAa,IACtHA,IACAA,EAAWC,UAWf,IAAI4F,GAAU,SAAUpK,EAAKQ,GACzB,MAAO,IAAImB,SAAQ,SAAUC,EAASuB,GAClC9D,EAAEgJ,MACErI,IAAKA,EACLQ,KAAMA,EACN6J,SAAU,OACV3J,QAAS,SAAUZ,GACXA,EAASY,QACTkB,EAAQ9B,EAASiB,SAEjBoC,EAAO,GAAI1E,OAAM,wBAA0BqB,EAASiB,WAG5DF,MAAO,SAAU2H,EAAKS,GAClB9F,EAAO,GAAI1E,OAAM,wBAA0BwK,SAY3D1L,GAAQ2B,UAAY,SAAU+C,EAAMlD,GAChC,GAAa,UAATkD,EAAkB,CAClBrE,OAAO0M,SAASC,OAAS3M,OAAO0M,SAASC,QACrC3M,OAAO0M,SAASE,SAAW,KAAO5M,OAAO0M,SAASG,UACjD7M,OAAO0M,SAASI,KAAO,IAAM9M,OAAO0M,SAASI,KAAM,GACxD,IAAI1K,GAAMpC,OAAO0M,SAASC,OAAS,0BAC/BI,GACA5L,OAAQA,EACR6L,aAAchN,OAAO0M,SAASC,OAAS,0BAK3C,OAHI3M,QAAOkK,gBACA6C,GAAM,cAEb/M,OAAOmB,GACA4C,QAAQC,SACXgD,OAAQhH,OAAOmB,GAAQ8L,UACvBrK,KAAM5C,OAAOmB,GAAQ+L,aACrBnG,KAAM/G,OAAOmB,GAAQgM,UAGlBX,EAAQpK,EAAK2K,GAAOxL,KAAK,SAAUW,GACtC,OACI8E,OAAQ9E,EAAS+K,UACjBrK,KAAMV,EAASgL,aACfnG,KAAM7E,EAASiL,WAK/B,MAAOpJ,SAAQwB,OAAO,GAAI1E,OAAM,+CAGjCG,KAAKyC,KAAuB,mBAAXxD,QAAyBA,OAAyB,mBAATC,MAAuBA,KAAyB,mBAAXF,QAAyBA,qBAChH,IAAI","file":"image_upload.min.js","sourcesContent":["!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var f;\"undefined\"!=typeof window?f=window:\"undefined\"!=typeof global?f=global:\"undefined\"!=typeof self&&(f=self),f.imageUpload=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar Upload = require('./lib/upload')\nvar vendorLib = require('./lib/vendor')\n\n/**\n * imageUpload function\n * @param  {string} vendor  'upyun/qiniu/upyun_im'\n * @param  {Object} options upload config\n * @return {Promise}        promise resolve upload object, reject any error (mostly: server_config error: xxxx)\n */\nfunction imageUpload(vendor, options) {\n    if (typeof vendor === 'object') {\n        options = vendor\n        vendor = 'upyun'\n    }\n    vendor = vendor || 'upyun'\n    if (typeof options !== 'object') {\n        options = {}\n    }\n    return vendorLib.getConfig('image', vendor).then(function (config) {\n        $.extend(config, {\n            accept: 'image/*',\n            timeout: 5000,\n            compress: {\n                max_width: 300,\n                max_height: 300\n            }\n        }, options)\n        return new Upload(config)\n    })\n}\n\n/**\n * get uploaded image Thumbnail url\n * @param  {Object} response reponse object\n * @param  {string} suffix   path suffix(180x180)\n * @param  {string} vendor   'upyun/qiniu/upyun_im'\n * @return {string}          Thumbnail url\n */\ngetThumbnailUrl = function (vendor, response, suffix) {\n    vendor = vendor || 'upyun'\n    var url = response.url || response.upload_ret.url\n    url = url.split('#')[0]\n    suffix = suffix ? ('_' + suffix) : '_sq'\n    if (vendor === 'upyun') {\n        return 'http://img' + (url.charCodeAt(1) % 3 + 4) + '.baixing.net' + url + suffix\n    } else if (vendor === 'qiniu') {\n        return 'http://img7.baixing.net/' + url + suffix\n    }\n}\n\n/**\n * get url for db store\n * @param  {Object} response reponse object\n * @param  {String} vendor   'upyun/qiniu/upyun_im'\n * @return {string}          url\n */\ngetUrl = function (vendor, response) {\n    vendor = vendor || 'upyun'\n    var url = response.url || response.upload_ret.url\n    url = url.split('#')[0]\n    var suffix = ''\n    if (vendor === 'upyun' || vendor === 'upyun_im') {\n        suffix = '#up'\n    } else if (vendor === 'qiniu') {\n        suffix = '#qn'\n    }\n    return url + suffix\n}\n\nmodule.exports = imageUpload\n\n// image-upload init via data-API\n$(function () {\n    $('[data-image-upload]').each(function (index, element) {\n        var vendor = $(element).data('vendor')\n        var suffix = $(element).data('suffix')\n        imageUpload(vendor, {\n            trigger: $(element),\n            success: function (response, uid) {\n                if (typeof response === 'string') {\n                    response = $.parseJSON(response)\n                }\n                if (response.code === 200 || (vendor === 'qiniu' && !response.error)) {\n                    var thumbnailUrl = getThumbnailUrl(vendor, response, suffix)\n                    var url = getUrl(vendor, response)\n                    $(element).trigger('imageUploadSuccess', [thumbnailUrl, url, uid])\n                } else {\n                    $(element).trigger('imageUploadError', [response.message || response.error, uid])\n                }\n            },\n            error: function (err, uid) {\n                if (err.message.indexOf('compress error') === 0) {\n                    return\n                }\n                if (err.message === 'upload error: timeout') {\n                    $(element).trigger('imageUploadTimeout', [uid])\n                    return\n                }\n                $(element).trigger('imageUploadError', [err.message, uid])\n            },\n            progress: function (position, total, percent, uid) {\n                $(element).trigger('imageUploadProgress', arguments)\n            },\n            select: function (files, uids) {\n                $(element).trigger('imageUploadSelect', arguments)\n                this.submit()\n            }\n        })['catch'](function (err) {\n            $(element).trigger('imageUploadError', err.message)\n        })\n    })\n})\n\n\n},{\"./lib/upload\":3,\"./lib/vendor\":4}],2:[function(require,module,exports){\n(function (global){\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nif (ES6Promise) {\n    ES6Promise.polyfill()\n}\n\n/**\n * compress (now only support image)\n * @param  {File}    file\n * @param  {object}  options {max_width, max_height, quality}\n * @return {Promise}\n */\nfunction compress(file, options) {\n\n    // do not need to compress\n    if (options === false) {\n        return Promise.resolve(file)\n    }\n\n    // check File API support\n    if (!window.File || !window.FileReader || !window.URL) {\n        return Promise.reject(new Error('File API not support'))\n    }\n\n    // check file param\n    if (!(file instanceof File)) {\n        return Promise.reject(new Error('file invalid'))\n    }\n\n    // can not compress\n    if (!(/image/i).test(file.type)) {\n        return Promise.reject(new Error('file is not image'))\n    }\n    if (typeof options !== 'object') {\n        options = {}\n    }\n    return new Promise(function (resolve, reject) {\n\n        // read the files\n        var reader = new FileReader()\n        reader.readAsArrayBuffer(file)\n        reader.onload = function (event) {\n\n            // blob stuff\n            var blob = new Blob([event.target.result])\n            window.URL = window.URL || window.webkitURL\n            var blobURL = window.URL.createObjectURL(blob)\n\n            // helper Image object\n            var image = new Image()\n            image.src = blobURL\n            image.onload = function() {\n\n                // send it to canvas\n                var dataURI = resize(image, file.type, options)\n                var blob = dataURItoBlob(dataURI)\n                resolve(blob)\n            }\n        }\n    })\n}\n\n/**\n * resize Image through canvas\n * @param  {Image}  img      DOM Element\n * @param  {string} type     MIME-STRING\n * @param  {number} options  {max_width, max_height, quality}\n * @return {string}          base64/URLEncoded data\n */\nfunction resize(img, type, options) {\n    var width = img.width\n    var height = img.height\n    var max_width = options.max_width || width\n    var max_height = options.max_height || height\n    var quality = options.quality || null\n\n    // calculate the width and height, constraining the proportions\n    if (width > height) {\n        if (width > max_width) {\n            height = Math.round(height *= max_width / width)\n            width = max_width\n        }\n    } else {\n        if (height > max_height) {\n            width = Math.round(width *= max_height / height)\n            height = max_height\n        }\n    }\n\n    // resize the canvas and draw the image data into it\n    var canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    var ctx = canvas.getContext(\"2d\")\n    ctx.drawImage(img, 0, 0, width, height)\n    return canvas.toDataURL(type, quality)\n}\n\n/**\n * convert base64/URLEncoded data component to raw binary data held in a string\n * @param  {string} dataURI base64/URLEncoded data\n * @return {string}         raw binary data\n */\nfunction dataURItoBlob(dataURI) {\n    var byteString = ''\n    if (dataURI.split(',')[0].indexOf('base64') >= 0) {\n        byteString = atob(dataURI.split(',')[1])\n    }\n    else {\n        byteString = unescape(dataURI.split(',')[1])\n    }\n\n    // separate out the mime component\n    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0]\n\n    // write the bytes of the string to a typed array\n    var ia = new Uint8Array(byteString.length)\n    for (var i = 0; i < byteString.length; i++) {\n        ia[i] = byteString.charCodeAt(i)\n    }\n    return new Blob([ia], {type: mimeString})\n}\n\nmodule.exports = compress\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],3:[function(require,module,exports){\n(function (global){\n/*\n * Base on arale/upload\n * error message: 'compress error: xxxx/upload error: xxxx'\n * error will call settings.error function\n * Compress error only do not compress, do not stop uploading\n */\n\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nvar compress = require('./compress')\n\nif (ES6Promise) {\n    ES6Promise.polyfill()\n}\nvar iframeCount = 0\nvar uid = 0\n\n/**\n * Upload constructor\n * @param {Object} options config\n */\nfunction Upload(options) {\n    if (!(this instanceof Upload)) {\n        return new Upload(options)\n    }\n    if (typeof options !== 'object') {\n        options = {}\n    }\n    var settings = {\n        trigger: null,\n        name: 'file',\n        action: '/upload',\n        accept: null,\n        data: null,\n        multiple: true,\n        select: null,\n        error: null,\n        success: null,\n        progress: null,\n        compress: false,\n        timeout: 10000\n    }\n    $.extend(settings, options)\n    this.settings = settings\n\n    this.setup()\n    this.bind()\n}\n\n/**\n * init hidden form contains hidden input(settings.data) and file input\n */\nUpload.prototype.setup = function () {\n    this.form = $(\n        '<form method=\"post\" enctype=\"multipart/form-data\"'\n        + 'target=\"\" action=\"' + this.settings.action + '\" />'\n    )\n\n    var data = this.settings.data\n    this.form.append(createInputs(data))\n\n    var input = document.createElement('input')\n    input.type = 'file'\n    input.name = this.settings.name\n    if (this.settings.accept) {\n        input.accept = this.settings.accept\n    }\n    if (this.settings.multiple) {\n        input.multiple = true\n        input.setAttribute('multiple', 'multiple')\n    }\n    this.input = $(input)\n\n    var $trigger = $(this.settings.trigger)\n    this.input.attr('hidefocus', true).css({\n        position: 'absolute',\n        top: 0,\n        right: 0,\n        opacity: 0,\n        outline: 0,\n        cursor: 'pointer',\n        height: $trigger.outerHeight(),\n        fontSize: Math.max(64, $trigger.outerHeight() * 5)\n    })\n    this.form.append(this.input)\n    this.form.css({\n        position: 'absolute',\n        top: $trigger.offset().top,\n        left: $trigger.offset().left,\n        overflow: 'hidden',\n        width: $trigger.outerWidth(),\n        height: $trigger.outerHeight(),\n        zIndex: findzIndex($trigger) + 10\n    }).appendTo('body')\n}\n\n/**\n * bind the trigger element to hidden form\n */\nUpload.prototype.bind = function () {\n    var self = this\n    var $trigger = $(self.settings.trigger)\n    $trigger.mouseenter(function () {\n        self.form.css({\n            top: $trigger.offset().top,\n            left: $trigger.offset().left,\n            width: $trigger.outerWidth(),\n            height: $trigger.outerHeight()\n        })\n    })\n    self.bindInput()\n}\n\n/**\n * handle file input change event\n * it will be filtered via extension\n */\nUpload.prototype.bindInput = function () {\n    var self = this\n    self.files = []\n    self.input.change(function(e) {\n\n        // ie9- don't support FileList Object\n        self.files = this.files || [{\n            name: e.target.value.split('\\\\').pop()\n        }]\n        self.uids = $.map(self.files, function (index, file) {\n            return uid++\n        })\n\n        if (self.settings.select) {\n            self.settings.select.call(self, self.files, self.uids)\n        } else {\n            self.submit()\n        }\n    })\n}\n\n/**\n * upload file to serevr\n * use ajax or form\n */\nUpload.prototype.submit = function () {\n    if (window.FormData) {\n        this.ajaxSubmit()\n    } else {\n        this.formSubmit()\n    }\n}\n\n/**\n * upload file by ajax\n * it will be compressed\n * success or error will trigger callback function\n */\nUpload.prototype.ajaxSubmit = function () {\n    var self = this\n\n    // upyun server do not support multiple files upload\n    var files = self.files\n    var promiseArr = []\n    $.each(files, function (index, file) {\n        var promise = compress(file, self.settings.compress)['catch'](function (err) {\n\n            // compress failed\n            if (self.settings.error) {\n                self.settings.error(new Error('compress error: ' + err.message), self.uids[index])\n            }\n        }).then(function (blob) {\n\n            // add data\n            self.input.prop('disabled', true)\n            var form = new FormData(self.form.get(0))\n            self.input.prop('disabled', false)\n\n            // add file\n            blob = blob || file\n            form.append(self.settings.name, blob, file.name)\n            return new Promise(function (resolve, reject) {\n                $.ajax({\n                    url: self.settings.action,\n                    type: 'post',\n                    processData: false,\n                    contentType: false,\n                    data: form,\n                    timeout: self.settings.timeout,\n                    xhr: function () {\n                        var xhr = $.ajaxSettings.xhr()\n                        if (xhr.upload && self.settings.progress) {\n                            xhr.upload.addEventListener('progress', function(event) {\n                                var percent = 0\n                                var position = event.loaded || event.position\n                                var total = event.total\n                                if (event.lengthComputable) {\n                                    percent = Math.ceil(position / total * 100)\n                                }\n                                self.settings.progress(position, total, percent, self.uids[index])\n                            }, false)\n                        }\n                        return xhr\n                    },\n                    success: function (data) {\n                        if (self.settings.success) {\n                            self.settings.success(data, self.uids[index])\n                        }\n                        resolve()\n                    },\n                    error: function (xhr, textStatus) {\n                        if (self.settings.error) {\n                            self.settings.error(new Error('upload error: ' + textStatus), self.uids[index])\n                        }\n                        resolve()\n                    }\n                })\n            })\n        })\n        promiseArr.push(promise)\n    })\n\n    // upload finished then refresh\n    Promise.all(promiseArr).then(function () {\n        self.refreshInput()\n    })\n}\n\n/**\n * upload file by form submit\n * success or error will trigger callback function\n */\nUpload.prototype.formSubmit = function () {\n    var self = this\n    self.iframe = newIframe()\n    self.form.attr('target', self.iframe.attr('name'))\n    self.iframe.data('uid', self.uids[0])\n    $('body').append(self.iframe)\n    var timer = null\n    self.iframe.one('load', function () {\n        clearTimeout(timer)\n\n        // Fix for IE endless progress bar activity bug\n        // (happens on form submits to iframe targets):\n        $('<iframe src=\"javascript:false;\"></iframe>')\n            .appendTo(self.form)\n            .remove()\n        var response = null\n        try {\n            response = $.trim($(this).contents().find(\"body\").html())\n        } catch (e) {\n            if (self.settings.error) {\n                self.settings.error(new Error('upload error: cross domain'), $(this).data('uid'))\n            }\n        } finally {\n            if (response !== null && self.settings.success) {\n                self.settings.success(response, $(this).data('uid'))\n            }\n\n            // upload finished then refresh\n            self.refreshInput()\n            $(this).remove()\n        }\n    })\n    self.form.submit()\n    timer = setTimeout(function () {\n        if (self.settings.error) {\n            self.settings.error(new Error('upload error: timeout'), self.iframe.data('uid'))\n        }\n\n        // upload finished then refresh\n        self.refreshInput()\n        self.iframe.remove()\n    }, self.settings.timeout)\n}\n\n/**\n * replace the input element\n * or the same file can not to be uploaded\n */\nUpload.prototype.refreshInput = function () {\n    var newInput = this.input.clone()\n    this.input.before(newInput)\n    this.input.off('change')\n    this.input.remove()\n    this.input = newInput\n    this.bindInput()\n}\n\n/**\n * set settings.select\n * @param  {Function} callback override settings.select\n * @return {Object}            upload object\n */\nUpload.prototype.select = function(callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.select = callback\n    return this\n}\n\n/**\n * set settings.success\n * @param  {Function} callback override settings.success\n * @return {Object}            upload object\n */\nUpload.prototype.success = function(callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.success = callback\n    return this\n}\n\n/**\n * set settings.error\n * @param  {Function} callback override settings.error\n * @return {Object}            upload object\n */\nUpload.prototype.error = function(callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.error = callback\n    return this\n}\n\n/**\n * set settings.progress\n * @param  {Function} callback override settings.progress\n * @return {Object}            upload object\n */\nUpload.prototype.progress = function(callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.progress = callback\n    return this\n}\n\n/**\n * create hidden input for data\n * @param  {Object} data settings.data\n * @return {Array}       array of hidden input\n */\nfunction createInputs(data) {\n    if (!data) return []\n    var inputs = [], i\n    for (var name in data) {\n        i = document.createElement('input')\n        i.type = 'hidden'\n        i.name = name\n        i.value = data[name]\n        inputs.push(i)\n    }\n    return inputs\n}\n\n/**\n * find the parents\n * @param  {jQueryElement} $node\n * @return {number}               parents max zIndex + 10\n */\nfunction findzIndex($node) {\n    var parents = $node.parentsUntil('body')\n    var zIndex = 0\n    for (var i = 0; i < parents.length; i++) {\n        var item = parents.eq(i)\n        if (item.css('position') !== 'static') {\n            zIndex = parseInt(item.css('zIndex'), 10) || zIndex\n        }\n    }\n    return zIndex\n}\n\n/**\n * init iframe when trigger form submit\n * @return {jQueryElement} iframe element of jQuery\n */\nfunction newIframe() {\n    var iframeName = 'iframe-Upload-' + iframeCount\n    var iframe = $('<iframe name=\"' + iframeName + '\" />').hide()\n    iframeCount += 1\n    return iframe\n}\n\nmodule.exports = Upload\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./compress\":2}],4:[function(require,module,exports){\n(function (global){\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nif (ES6Promise) {\n    ES6Promise.polyfill()\n}\n\n// err message: 'server_config error: xxxx'\n\n/**\n * get Json via ajax\n * @param  {string} url  the server url\n * @param  {Object} data query data\n * @return {Promise}     promise resolve message\n */\nvar getJson = function (url, data) {\n    return new Promise(function (resolve, reject) {\n        $.ajax({\n            url: url,\n            data: data,\n            dataType: 'json',\n            success: function (response) {\n                if (response.success) {\n                    resolve(response.message)\n                } else {\n                    reject(new Error('server_config error: ' + response.message))\n                }\n            },\n            error: function (xhr, textStatus) {\n                reject(new Error('server_config error: ' + textStatus))\n            }\n        })\n    })\n}\n\n/**\n * get server config\n * @param  {string} type   'image/media'\n * @param  {string} vendor 'upyun/qiniu/upyun_im'\n * @return {Promise}        promise resolve server config\n */\nexports.getConfig = function (type, vendor) {\n    if (type === 'image') {\n        window.location.origin = window.location.origin ||\n            window.location.protocol + \"//\" + window.location.hostname +\n            (window.location.port ? ':' + window.location.port: '')\n        var url = window.location.origin + '/imageUpload/getConfig/'\n        var query = {\n            vendor: vendor,\n            'return-url': window.location.origin + '/imageUpload/getResult/'\n        }\n        if (window.FormData) {\n            delete query['return-url']\n        }\n        if (window[vendor]) {\n            return Promise.resolve({\n                action: window[vendor].uploadUrl,\n                data: window[vendor].uploadParams,\n                name: window[vendor].fileKey\n            })\n        } else {\n            return getJson(url, query).then(function (response) {\n                return {\n                    action: response.uploadUrl,\n                    data: response.uploadParams,\n                    name: response.fileKey\n                }\n            })\n        }\n    }\n    return Promise.reject(new Error('server_config error: ' + 'media type invalid'))\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}]},{},[1])(1)\n});"],"sourceRoot":"/source/"}