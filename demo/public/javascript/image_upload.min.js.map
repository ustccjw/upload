{"version":3,"sources":["image_upload.min.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"imageUpload","vendor","options","vendorConfig","then","config","$","extend","accept","timeout","compress","max_width","max_height","quality","Upload","getThumbnailUrl","response","suffix","url","upload_ret","split","charCodeAt","getUrl","each","index","element","data","trigger","success","uid","parseJSON","error","thumbnailUrl","message","err","progress","slice","arguments","select","this","submit","console","log","./lib/upload","./lib/vendor_config",2,"module","global","file","Promise","resolve","window","File","FileReader","URL","test","type","reject","reader","readAsArrayBuffer","onload","event","blob","Blob","target","result","webkitURL","blobURL","createObjectURL","image","Image","src","dataURI","resize","dataURItoBlob","img","width","height","Math","round","canvas","document","createElement","ctx","getContext","drawImage","toDataURL","byteString","indexOf","atob","unescape","mimeString","ia","Uint8Array","ES6Promise","polyfill","self",3,"settings","name","action","multiple","setup","bind","createInputs","map","value","key","attr","findzIndex","$node","zIndex","parents","item","css","parseInt","newIframe","iframeCount","hide","prototype","form","method","enctype","append","input","$trigger","outerWidth","offsetWidth","outerHeight","offsetHeight","position","left","top","opacity","outline","cursor","offset","overflow","appendTo","on","show","bindInput","files","pop","uids","promise","FormData","ajaxSubmit","formSubmit","refreshInput","promiseArr","prop","get","ajax","processData","contentType","xhr","ajaxSettings","upload","addEventListener","percent","loaded","total","lengthComputable","ceil","textStatus","errorThrown","push","all","iframe","timer","one","undefined","clearTimeout","remove","trim","contents","find","html","setTimeout","newInput","clone","before","off","callback","./compress",4,"getJson","dataType","getConfig","location","origin","protocol","hostname","port","query","return-url","cache","toUpperCase","uploadUrl","uploadParams","fileKey"],"mappings":"CAAA,QAAUA,GAAEC,EAAEC,EAAEC,GAAG,QAASC,GAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,GAAIE,GAAkB,kBAATC,UAAqBA,OAAQ,KAAIF,GAAGC,EAAE,MAAOA,GAAEF,GAAE,EAAI,IAAGI,EAAE,MAAOA,GAAEJ,GAAE,EAAI,IAAIK,GAAE,GAAIC,OAAM,uBAAuBN,EAAE,IAAK,MAAMK,GAAEE,KAAK,mBAAmBF,EAAE,GAAIG,GAAEX,EAAEG,IAAIS,WAAYb,GAAEI,GAAG,GAAGU,KAAKF,EAAEC,QAAQ,SAASd,GAAG,GAAIE,GAAED,EAAEI,GAAG,GAAGL,EAAG,OAAOI,GAAEF,EAAEA,EAAEF,IAAIa,EAAEA,EAAEC,QAAQd,EAAEC,EAAEC,EAAEC,GAAG,MAAOD,GAAEG,GAAGS,QAAkD,IAAI,GAA1CL,GAAkB,kBAATD,UAAqBA,QAAgBH,EAAE,EAAEA,EAAEF,EAAEa,OAAOX,IAAID,EAAED,EAAEE,GAAI,OAAOD,KAAKa,GAAG,SAAST,GAUxc,QAASU,GAAYC,EAAQC,GAS5B,MARsB,gBAAXD,KACVC,EAAUD,EACVA,EAAS,SAEVA,EAASA,GAAU,QACI,gBAAZC,KACVA,MAEMC,EAAa,QAASF,GAAQG,KAAK,SAAUC,GAUnD,MATAC,GAAEC,OAAOF,GACRG,OAAQ,UACRC,QAAS,IACTC,UACCC,UAAW,IACXC,WAAY,IACZC,QAAS,KAERX,GACI,GAAIY,GAAOT,KAWpB,QAASU,GAAgBd,EAAQe,EAAUC,GAC1ChB,EAASA,GAAU,OACnB,IAAIiB,GAAMF,EAASE,KAAOF,EAASG,WAAWD,GAG9C,OAFAA,GAAMA,EAAIE,MAAM,KAAK,GACrBH,EAASA,EAAU,IAAMA,EAAU,MACpB,UAAXhB,EACI,cAAgBiB,EAAIG,WAAW,GAAK,EAAI,GAAK,eAAiBH,EAAMD,EACtD,UAAXhB,EACH,2BAA6BiB,EAAMD,EADpC,OAWR,QAASK,GAAOrB,EAAQe,GACvBf,EAASA,GAAU,OACnB,IAAIiB,GAAMF,EAASE,KAAOF,EAASG,WAAWD,GAC9CA,GAAMA,EAAIE,MAAM,KAAK,EACrB,IAAIH,GAAS,EAMb,OALe,UAAXhB,GAAiC,aAAXA,EACzBgB,EAAS,MACY,UAAXhB,IACVgB,EAAS,OAEHC,EAAMD,EAnEd,GAAIH,GAASxB,EAAQ,gBACjBa,EAAeb,EAAQ,sBAsE3BgB,GAAE,WACDA,EAAE,uBAAuBiB,KAAK,SAAUC,EAAOC,GAC9C,GAAIxB,GAASK,EAAEmB,GAASC,KAAK,UACzBlB,EAASF,EAAEmB,GAASC,KAAK,UACzBT,EAASX,EAAEmB,GAASC,KAAK,SAC7B1B,GAAYC,GACX0B,QAASrB,EAAEmB,GACXjB,OAAQA,EACRoB,QAAS,SAAUZ,EAAUa,GAI5B,GAHwB,gBAAbb,KACVA,EAAWV,EAAEwB,UAAUd,IAEF,MAAlBA,EAAStB,MAA4B,UAAXO,IAAuBe,EAASe,MAAQ,CACrE,GAAIC,GAAejB,EAAgBd,EAAQe,EAAUC,GACjDC,EAAMI,EAAOrB,EAAQe,EACzBV,GAAEmB,GAASE,QAAQ,sBAAuBK,EAAcd,EAAKW,QAE7DvB,GAAEmB,GAASE,QAAQ,oBAAqBX,EAASiB,SAAWjB,EAASe,MAAOF,KAG9EE,MAAO,SAAUG,EAAKL,GACrBvB,EAAEmB,GAASE,QAAQ,oBAAqBO,EAAID,QAASJ,KAEtDM,SAAU,WACT7B,EAAEmB,GAASE,QAAQ,yBAA0BS,MAAMvC,KAAKwC,UAAW,KAEpEC,OAAQ,WACPhC,EAAEmB,GAASE,QAAQ,uBAAwBS,MAAMvC,KAAKwC,UAAW,IACjEE,KAAKC,YAEJ,SAAS,SAAUN,GACrBO,QAAQC,IAAIR,WAMZS,eAAe,EAAEC,sBAAsB,IAAIC,GAAG,SAASvD,EAAQwD,IAClE,SAAWC,GACX,YAWA,SAASrC,GAASsC,EAAM9C,GAGvB,MAAIA,MAAY,EACR+C,QAAQC,QAAQF,GAInBG,OAAOC,MAASD,OAAOE,YAAeF,OAAOG,IAK5CN,YAAgBI,MAKjB,SAAWG,KAAKP,EAAKQ,OAGH,gBAAZtD,KACVA,MAEM,GAAI+C,SAAQ,SAAUC,EAASO,GAGrC,GAAIC,GAAS,GAAIL,WACjBK,GAAOC,kBAAkBX,GACzBU,EAAOE,OAAS,SAAUC,GAGzB,IACC,GAAIC,GAAO,GAAIC,OAAMF,EAAMG,OAAOC,QAClCd,QAAOG,IAAMH,OAAOG,KAAOH,OAAOe,SAClC,IAAIC,GAAUhB,OAAOG,IAAIc,gBAAgBN,GAGrCO,EAAQ,GAAIC,MAChBD,GAAME,IAAMJ,EACZE,EAAMT,OAAS,WAGd,IACC,GAAIY,GAAUC,EAAOJ,EAAOrB,EAAKQ,KAAMtD,GACnC4D,EAAOY,EAAcF,EACzBtB,GAAQY,GACP,MAAO5B,GACRuB,EAAOvB,KAGR,MAAOA,GACRuB,EAAOvB,QAjCFe,QAAQQ,OAAO,GAAIhE,OAAM,sBALzBwD,QAAQQ,OAAO,GAAIhE,OAAM,iBALzBwD,QAAQQ,OAAO,GAAIhE,OAAM,yBAwDlC,QAASgF,GAAOE,EAAKnB,EAAMtD,GAC1B,GAAI0E,GAAQD,EAAIC,MACZC,EAASF,EAAIE,OACblE,EAAYT,EAAQS,WAAaiE,EACjChE,EAAaV,EAAQU,YAAciE,EACnChE,EAAUX,EAAQW,SAAW,IAG7B+D,GAAQC,EACPD,EAAQjE,IACXkE,EAASC,KAAKC,MAAMF,GAAUlE,EAAYiE,GAC1CA,EAAQjE,GAGLkE,EAASjE,IACZgE,EAAQE,KAAKC,MAAMH,GAAShE,EAAaiE,GACzCA,EAASjE,EAKX,IAAIoE,GAASC,SAASC,cAAc,SACpCF,GAAOJ,MAAQA,EACfI,EAAOH,OAASA,CAChB,IAAIM,GAAMH,EAAOI,WAAW,KAE5B,OADAD,GAAIE,UAAUV,EAAK,EAAG,EAAGC,EAAOC,GACzBG,EAAOM,UAAU9B,EAAM3C,GAQ/B,QAAS6D,GAAcF,GACtB,GAAIe,GAAa,EAEhBA,GADGf,EAAQpD,MAAM,KAAK,GAAGoE,QAAQ,WAAa,EACjCC,KAAKjB,EAAQpD,MAAM,KAAK,IAGxBsE,SAASlB,EAAQpD,MAAM,KAAK,GAQ1C,KAAK,GAJDuE,GAAanB,EAAQpD,MAAM,KAAK,GAAGA,MAAM,KAAK,GAAGA,MAAM,KAAK,GAG5DwE,EAAK,GAAIC,YAAWN,EAAWzF,QAC1BP,EAAI,EAAGA,EAAIgG,EAAWzF,OAAQP,IACtCqG,EAAGrG,GAAKgG,EAAWlE,WAAW9B,EAE/B,OAAO,IAAIwE,OAAM6B,IAAMpC,KAAMmC,IA7H9B,GAAIG,GAAgC,mBAAX3C,QAAyBA,OAAO2C,WAA+B,mBAAX/C,GAAyBA,EAAO+C,WAAa,IAC1HA,GAAWC,WA+HXjD,EAAOlD,QAAUc,IAEdb,KAAK0C,KAAuB,mBAAXQ,QAAyBA,OAAyB,mBAATiD,MAAuBA,KAAyB,mBAAX7C,QAAyBA,gBACrH8C,GAAG,SAAS3G,EAAQwD,IAC1B,SAAWC,GAOX,YAaA,SAASjC,GAAOZ,GACf,KAAMqC,eAAgBzB,IACrB,MAAO,IAAIA,GAAOZ,EAEI,iBAAZA,KACVA,KAED,IAAIgG,IACHvE,QAAS,KACTwE,KAAM,OACNC,OAAQ,UACR5F,OAAQ,KACRkB,KAAM,KACN2E,UAAU,EACV/D,OAAQ,KACRP,MAAO,KACPH,QAAS,KACTO,SAAU,KACVzB,UAAU,EACVD,QAAS,KAIV,IAFAH,EAAEC,OAAO2F,EAAUhG,GACnBqC,KAAK2D,SAAWA,GACX5F,EAAEiC,KAAK2D,SAASvE,SAAS7B,OAC7B,KAAML,OAAM,gCAGb8C,MAAK+D,QACL/D,KAAKgE,OA2UN,QAASC,GAAa9E,GACrB,MAAKA,GACEpB,EAAEmG,IAAI/E,EAAM,SAAUgF,EAAOC,GACnC,MAAOrG,GAAE,mBAAmBsG,MAC3BpD,KAAM,SACN2C,KAAMQ,EACND,MAAOA,SAUV,QAASG,GAAWC,GACnB,GAAIC,GAAS,CASb,OARAzG,GAAEiB,KAAKuF,EAAME,UAAW,SAAUxF,EAAOyF,GACxC,MAAIA,KAAS3G,EAAE,QAAQ,IACf,OAEwB,WAA5BA,EAAE2G,GAAMC,IAAI,cACfH,EAASI,SAAS7G,EAAE2G,GAAMC,IAAI,UAAW,KAAOH,MAG3CA,EAOR,QAASK,KACR,MAAO9G,GAAE,qBAAqBsG,MAC7BT,KAAM,iBAAmBkB,MACvBC,OAtZJ,GAAIxB,GAAgC,mBAAX3C,QAAyBA,OAAO2C,WAA+B,mBAAX/C,GAAyBA,EAAO+C,WAAa,KACtHpF,EAAWpB,EAAQ,aAEvBwG,GAAWC,UACX,IAAIsB,GAAc,EACdxF,EAAM,CAwCVf,GAAOyG,UAAUjB,MAAQ,WACxB/D,KAAKiF,KAAOlH,EAAE,iBAAiBsG,MAC9Ba,OAAQ,OACRC,QAAS,sBACTtB,OAAQ7D,KAAK2D,SAASE,SAEvB7D,KAAKiF,KAAKG,OAAOnB,EAAajE,KAAK2D,SAASxE,OAE5Ca,KAAKqF,MAAQtH,EAAE,mBAAmBsG,MACjCpD,KAAM,OACN2C,KAAM5D,KAAK2D,SAASC,KACpB3F,OAAQ+B,KAAK2D,SAAS1F,QAAU,GAChC6F,WAAY9D,KAAK2D,SAASG,UAE3B,IAAIwB,GAAWvH,EAAEiC,KAAK2D,SAASvE,SAC3BmG,EAAaD,EAASC,WAAcD,EAASC,aAAeD,EAAS,GAAGE,YACxEC,EAAcH,EAASG,YAAeH,EAASG,cAAgBH,EAAS,GAAGI,YAC/E1F,MAAKqF,MAAMhB,KAAK,aAAa,GAAMM,KAClCgB,SAAU,WACVC,KAAM,EACNC,IAAK,EACLxD,MAAOkD,EACPjD,OAAQmD,EACRK,QAAS,EACTC,QAAS,EACTC,OAAQ,YAEThG,KAAKiF,KAAKG,OAAOpF,KAAKqF,OACtBrF,KAAKiF,KAAKN,KACTgB,SAAU,WACVE,IAAKP,EAASW,SAASJ,IACvBD,KAAMN,EAASW,SAASL,KACxBvD,MAAOkD,EACPjD,OAAQmD,EACRS,SAAU,SACV1B,OAAQF,EAAWgB,GAAY,KAC7Ba,SAAS,SAMb5H,EAAOyG,UAAUhB,KAAO,WACvB,GAAIP,GAAOzD,KACPsF,EAAWvH,EAAE0F,EAAKE,SAASvE,SAC3BmG,EAAaD,EAASC,WAAcD,EAASC,aAAeD,EAAS,GAAGE,YACxEC,EAAcH,EAASG,YAAeH,EAASG,cAAgBH,EAAS,GAAGI,YAC/EJ,GAASc,GAAG,aAAc,WACzB3C,EAAKwB,KAAKN,KACTkB,IAAKP,EAASW,SAASJ,IACvBD,KAAMN,EAASW,SAASL,KACxBvD,MAAOkD,EACPjD,OAAQmD,IACNY,SAEJ5C,EAAK6C,aAMN/H,EAAOyG,UAAUsB,UAAY,WAC5B,GAAI7C,GAAOzD,IACXyD,GAAK8C,SAEL9C,EAAK4B,MAAMe,GAAG,SAAU,SAAS7J,GAGhCkH,EAAK8C,MAAQvG,KAAKuG,SACjB3C,KAAMrH,EAAEkF,OAAO0C,MAAMtF,MAAM,MAAM2H,QAElC/C,EAAKgD,KAAO1I,EAAEmG,IAAIT,EAAK8C,MAAO,WAC7B,MAAOjH,OAEJmE,EAAKE,SAAS5D,OACjB0D,EAAKE,SAAS5D,OAAOzC,KAAKmG,EAAMA,EAAK8C,MAAO9C,EAAKgD,MAEjDhD,EAAKxD,YAWR1B,EAAOyG,UAAU/E,OAAS,WACzB,GAAIwD,GAAOzD,KACP0G,EAAU,IASd,OAPCA,GADG9F,OAAO+F,SACAlD,EAAKmD,WAAWnD,EAAK8C,MAAO9C,EAAKgD,MAEjChD,EAAKoD,WAAWpD,EAAKgD,KAAK,IAErChD,EAAKqD,eAGEJ,EAAQ7I,KAAK,WACnB4F,EAAKwB,KAAKF,UAYZxG,EAAOyG,UAAU4B,WAAa,SAAUL,EAAOE,GAC9C,GAAIhD,GAAOzD,KAGP+G,IA+DJ,OA9DAhJ,GAAEiB,KAAKuH,EAAO,SAAUtH,EAAOwB,GAC9B,GAAIiG,GAAUvI,EAASsC,EAAMgD,EAAKE,SAASxF,UAAU,SAAS,WAG7D,MAAOsC,KACL5C,KAAK,SAAU0D,GAGjBkC,EAAK4B,MAAM2B,KAAK,YAAY,EAC5B,IAAI/B,GAAO,GAAI0B,UAASlD,EAAKwB,KAAKgC,IAAI,GAGtC,OAFAhC,GAAKG,OAAO3B,EAAKE,SAASC,KAAMrC,EAAMd,EAAKmD,MAC3CH,EAAK4B,MAAM2B,KAAK,YAAY,GACrB,GAAItG,SAAQ,SAAUC,EAASO,GACrCnD,EAAEmJ,MACDvI,IAAK8E,EAAKE,SAASE,OACnB5C,KAAM,OACNkG,aAAa,EACbC,aAAa,EACbjI,KAAM8F,EACN/G,QAASuF,EAAKE,SAASzF,QACvBmJ,IAAK,WACJ,GAAIA,GAAMtJ,EAAEuJ,aAAaD,KAYzB,OAXIA,GAAIE,QAAU9D,EAAKE,SAAS/D,UAC/ByH,EAAIE,OAAOC,iBAAiB,WAAY,SAASlG,GAChD,GAAImG,GAAU,EACV9B,EAAWrE,EAAMoG,QAAUpG,EAAMqE,SACjCgC,EAAQrG,EAAMqG,KACdrG,GAAMsG,mBACTH,EAAUlF,KAAKsF,KAAKlC,EAAWgC,EAAQ,MAExClE,EAAKE,SAAS/D,SAAS+F,EAAUgC,EAAOF,EAAShE,EAAKgD,KAAKxH,MACzD,GAEGoI,GAERhI,QAAS,SAAUF,GAClBwB,EAAQxB,IAETK,MAAO,SAAU6H,EAAKS,EAAYC,GAC7BA,IACHA,EAAc,IAAMA,EAErB,IAAIrI,GAAU,iBAAmBoI,EAAaC,CAC9C7G,GAAO,GAAIhE,OAAMwC,WAIlB7B,KAAK,SAAUsB,GAGbsE,EAAKE,SAAStE,SACjBoE,EAAKE,SAAStE,QAAQF,EAAMsH,EAAKxH,KAEhC,SAAUU,GAGR8D,EAAKE,SAASnE,OACjBiE,EAAKE,SAASnE,MAAMG,EAAK8G,EAAKxH,KAGhC8H,GAAWiB,KAAKtB,KAEVhG,QAAQuH,IAAIlB,IASpBxI,EAAOyG,UAAU6B,WAAa,SAAUvH,GACvC,GAAImE,GAAOzD,IAEX,OAAO,IAAIU,SAAQ,SAAUC,EAASO,GAGrCuC,EAAKyE,OAASrD,IACdpB,EAAKwB,KAAKZ,KAAK,SAAUZ,EAAKyE,OAAO7D,KAAK,SAC1CtG,EAAE,QAAQqH,OAAO3B,EAAKyE,OAGtB,IAAIC,GAAQ,IACZ1E,GAAKyE,OAAOE,IAAI,OAAQ,WAGvB,GAAc,OAAVD,EAAJ,CAKcE,SAAVF,GACHG,aAAaH,GAIdpK,EAAE,6CACAoI,SAAS1C,EAAKwB,MACdsD,QAGF,KACC,GAAI9J,GAAWV,EAAEyK,KAAKzK,EAAEiC,MAAMyI,WAAWC,KAAK,QAAQC,QACrD,MAAOhJ,GACRuB,EAAO,GAAIhE,OAAM,+BAElByD,EAAQlC,MAETgF,EAAKwB,KAAKhF,SAITkI,EADG1E,EAAKE,SAASzF,QAAU,EACnB0K,WAAW,WAClB1H,EAAO,GAAIhE,OAAM,0BACjBiL,EAAQ,MACN1E,EAAKE,SAASzF,SAETmK,SAEPxK,KAAK,SAAUsB,GAGbsE,EAAKE,SAAStE,SACjBoE,EAAKE,SAAStE,QAAQF,EAAMG,IAE3B,SAAUK,GAGR8D,EAAKE,SAASnE,OACjBiE,EAAKE,SAASnE,MAAMG,EAAKL,KAExBzB,KAAK,WAGP4F,EAAKyE,OAAOK,YAQdhK,EAAOyG,UAAU8B,aAAe,WAC/B,GAAI+B,GAAW7I,KAAKqF,MAAMyD,OAC1B9I,MAAKqF,MAAM0D,OAAOF,GAClB7I,KAAKqF,MAAM2D,IAAI,UACfhJ,KAAKqF,MAAMkD,SACXvI,KAAKqF,MAAQwD,EACb7I,KAAKsG,aAQN/H,EAAOyG,UAAUjF,OAAS,SAAUkJ,GACnC,MAAKA,IAGLjJ,KAAK2D,SAAS5D,OAASkJ,EAChBjJ,MAHCA,MAWTzB,EAAOyG,UAAU3F,QAAU,SAAU4J,GACpC,MAAKA,IAGLjJ,KAAK2D,SAAStE,QAAU4J,EACjBjJ,MAHCA,MAWTzB,EAAOyG,UAAUxF,MAAQ,SAAUyJ,GAClC,MAAKA,IAGLjJ,KAAK2D,SAASnE,MAAQyJ,EACfjJ,MAHCA,MAWTzB,EAAOyG,UAAUpF,SAAW,SAAUqJ,GACrC,MAAKA,IAGLjJ,KAAK2D,SAAS/D,SAAWqJ,EAClBjJ,MAHCA,MAkDTO,EAAOlD,QAAUkB,IAEdjB,KAAK0C,KAAuB,mBAAXQ,QAAyBA,OAAyB,mBAATiD,MAAuBA,KAAyB,mBAAX7C,QAAyBA,aACxHsI,aAAa,IAAIC,GAAG,SAASpM,EAAQwD,IACxC,SAAWC,GACX,YAaA,SAAS4I,GAAQzK,EAAKQ,GACrB,MAAO,IAAIuB,SAAQ,SAAUC,EAASO,GACrCnD,EAAEmJ,MACDvI,IAAKA,EACLQ,KAAMA,EACNkK,SAAU,OACVhK,QAAS,SAAUZ,GACdA,EAASY,QACZsB,EAAQlC,EAASiB,SAEjBwB,EAAO,GAAIhE,OAAM,wBAA0BuB,EAASiB,WAGtDF,MAAO,SAAU6H,EAAKS,EAAYC,GAC7BA,IACHA,EAAc,IAAMA,GAErB7G,EAAO,GAAIhE,OAAM,wBAA0B4K,EAAaC,SAY5D,QAASuB,GAAUrI,EAAMvD,GACxB,GAAa,UAATuD,EAAkB,CAChBL,OAAO2I,SAASC,SACpB5I,OAAO2I,SAASC,OAAS5I,OAAO2I,SAASE,SAAW,KACnD7I,OAAO2I,SAASG,UAAY9I,OAAO2I,SAASI,KAAO,IACnD/I,OAAO2I,SAASI,KAAM,IAExB,IAAIhL,GAAMiC,OAAO2I,SAASC,OAAS,0BAC/BI,GACHlM,OAAQA,EACRmM,aAAcjJ,OAAO2I,SAASC,OAAS,0BAEpC5I,QAAO+F,gBACHiD,GAAM,aAEd,IAAIE,GAAQlJ,OAAOlD,EAAOqM,cAC1B,OAAID,GACIpJ,QAAQC,SACdkD,OAAQiG,EAAME,UACd7K,KAAM2K,EAAMG,aACZrG,KAAMkG,EAAMI,UAGNd,EAAQzK,EAAKiL,GAAO/L,KAAK,SAAUY,GAEzC,MADAmC,QAAOlD,EAAOqM,eAAiBtL,GAE9BoF,OAAQpF,EAASuL,UACjB7K,KAAMV,EAASwL,aACfrG,KAAMnF,EAASyL,WAKnB,MAAOxJ,SAAQQ,OAAO,GAAIhE,OAAM,4CAzEjC,GAAIqG,GAAgC,mBAAX3C,QAAyBA,OAAO2C,WAA+B,mBAAX/C,GAAyBA,EAAO+C,WAAa,IAC1HA,GAAWC,WA2EXjD,EAAOlD,QAAUiM,IAEdhM,KAAK0C,KAAuB,mBAAXQ,QAAyBA,OAAyB,mBAATiD,MAAuBA,KAAyB,mBAAX7C,QAAyBA,qBAChH","file":"image_upload.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar Upload = require('./lib/upload')\nvar vendorConfig = require('./lib/vendor_config')\n\n/**\n * imageUpload function\n * @param  {string} vendor  'upyun/qiniu/upyun_im'\n * @param  {Object} options upload config\n * @return {Promise}        promise resolve upload object, reject any error (mostly: server_config error: xxxx)\n */\nfunction imageUpload(vendor, options) {\n\tif (typeof vendor === 'object') {\n\t\toptions = vendor\n\t\tvendor = 'upyun'\n\t}\n\tvendor = vendor || 'upyun'\n\tif (typeof options !== 'object') {\n\t\toptions = {}\n\t}\n\treturn vendorConfig('image', vendor).then(function (config) {\n\t\t$.extend(config, {\n\t\t\taccept: 'image/*',\n\t\t\ttimeout: 10000,\n\t\t\tcompress: {\n\t\t\t\tmax_width: 300,\n\t\t\t\tmax_height: 300,\n\t\t\t\tquality: 0.8\n\t\t\t}\n\t\t}, options)\n\t\treturn new Upload(config)\n\t})\n}\n\n/**\n * get uploaded image Thumbnail url\n * @param  {Object} response reponse object\n * @param  {string} suffix   path suffix(180x180)\n * @param  {string} vendor   'upyun/qiniu/upyun_im'\n * @return {string}          Thumbnail url\n */\nfunction getThumbnailUrl(vendor, response, suffix) {\n\tvendor = vendor || 'upyun'\n\tvar url = response.url || response.upload_ret.url\n\turl = url.split('#')[0]\n\tsuffix = suffix ? ('_' + suffix) : '_sq'\n\tif (vendor === 'upyun') {\n\t\treturn 'http://img' + (url.charCodeAt(1) % 3 + 4) + '.baixing.net' + url + suffix\n\t} else if (vendor === 'qiniu') {\n\t\treturn 'http://img7.baixing.net/' + url + suffix\n\t}\n}\n\n/**\n * get url for db store\n * @param  {Object} response reponse object\n * @param  {String} vendor   'upyun/qiniu/upyun_im'\n * @return {string}          url\n */\nfunction getUrl(vendor, response) {\n\tvendor = vendor || 'upyun'\n\tvar url = response.url || response.upload_ret.url\n\turl = url.split('#')[0]\n\tvar suffix = ''\n\tif (vendor === 'upyun' || vendor === 'upyun_im') {\n\t\tsuffix = '#up'\n\t} else if (vendor === 'qiniu') {\n\t\tsuffix = '#qn'\n\t}\n\treturn url + suffix\n}\n\n// image-upload init via data-API\n$(function () {\n\t$('[data-image-upload]').each(function (index, element) {\n\t\tvar vendor = $(element).data('vendor')\n\t\tvar accept = $(element).data('accept')\n\t\tvar suffix = $(element).data('suffix')\n\t\timageUpload(vendor, {\n\t\t\ttrigger: $(element),\n\t\t\taccept: accept,\n\t\t\tsuccess: function (response, uid) {\n\t\t\t\tif (typeof response === 'string') {\n\t\t\t\t\tresponse = $.parseJSON(response)\n\t\t\t\t}\n\t\t\t\tif (response.code === 200 || (vendor === 'qiniu' && !response.error)) {\n\t\t\t\t\tvar thumbnailUrl = getThumbnailUrl(vendor, response, suffix)\n\t\t\t\t\tvar url = getUrl(vendor, response)\n\t\t\t\t\t$(element).trigger('imageUploadSuccess', [thumbnailUrl, url, uid])\n\t\t\t\t} else {\n\t\t\t\t\t$(element).trigger('imageUploadError', [response.message || response.error, uid])\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (err, uid) {\n\t\t\t\t$(element).trigger('imageUploadError', [err.message, uid])\n\t\t\t},\n\t\t\tprogress: function (position, total, percent, uid) {\n\t\t\t\t$(element).trigger('imageUploadProgress', [].slice.call(arguments, 0))\n\t\t\t},\n\t\t\tselect: function (files, uids) {\n\t\t\t\t$(element).trigger('imageUploadSelect', [].slice.call(arguments, 0))\n\t\t\t\tthis.submit()\n\t\t\t}\n\t\t})['catch'](function (err) {\n\t\t\tconsole.log(err)\n\t\t})\n\t})\n})\n\n\n},{\"./lib/upload\":3,\"./lib/vendor_config\":4}],2:[function(require,module,exports){\n(function (global){\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nES6Promise.polyfill()\n\n/**\n * compress (now only support image)\n * @param  {File}    file\n * @param  {object}  options {max_width, max_height, quality}\n * @return {Promise}\n */\nfunction compress(file, options) {\n\n\t// do not need to compress\n\tif (options === false) {\n\t\treturn Promise.resolve(file)\n\t}\n\n\t// check File API support\n\tif (!window.File || !window.FileReader || !window.URL) {\n\t\treturn Promise.reject(new Error('File API not support'))\n\t}\n\n\t// check file param\n\tif (!(file instanceof File)) {\n\t\treturn Promise.reject(new Error('file invalid'))\n\t}\n\n\t// can not compress\n\tif (!(/image/i).test(file.type)) {\n\t\treturn Promise.reject(new Error('file is not image'))\n\t}\n\tif (typeof options !== 'object') {\n\t\toptions = {}\n\t}\n\treturn new Promise(function (resolve, reject) {\n\n\t\t// read the files\n\t\tvar reader = new FileReader()\n\t\treader.readAsArrayBuffer(file)\n\t\treader.onload = function (event) {\n\n\t\t\t// blob stuff\n\t\t\ttry {\n\t\t\t\tvar blob = new Blob([event.target.result])\n\t\t\t\twindow.URL = window.URL || window.webkitURL\n\t\t\t\tvar blobURL = window.URL.createObjectURL(blob)\n\n\t\t\t\t// helper Image object\n\t\t\t\tvar image = new Image()\n\t\t\t\timage.src = blobURL\n\t\t\t\timage.onload = function() {\n\n\t\t\t\t\t// send it to canvas\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvar dataURI = resize(image, file.type, options)\n\t\t\t\t\t\tvar blob = dataURItoBlob(dataURI)\n\t\t\t\t\t\tresolve(blob)\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\treject(err)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\treject(err)\n\t\t\t}\n\t\t}\n\t})\n}\n\n/**\n * resize Image through canvas\n * @param  {Image}  img      DOM Element\n * @param  {string} type     MIME-STRING\n * @param  {number} options  {max_width, max_height, quality}\n * @return {string}          base64/URLEncoded data\n */\nfunction resize(img, type, options) {\n\tvar width = img.width\n\tvar height = img.height\n\tvar max_width = options.max_width || width\n\tvar max_height = options.max_height || height\n\tvar quality = options.quality || null\n\n\t// calculate the width and height, constraining the proportions\n\tif (width > height) {\n\t\tif (width > max_width) {\n\t\t\theight = Math.round(height *= max_width / width)\n\t\t\twidth = max_width\n\t\t}\n\t} else {\n\t\tif (height > max_height) {\n\t\t\twidth = Math.round(width *= max_height / height)\n\t\t\theight = max_height\n\t\t}\n\t}\n\n\t// resize the canvas and draw the image data into it\n\tvar canvas = document.createElement('canvas')\n\tcanvas.width = width\n\tcanvas.height = height\n\tvar ctx = canvas.getContext(\"2d\")\n\tctx.drawImage(img, 0, 0, width, height)\n\treturn canvas.toDataURL(type, quality)\n}\n\n/**\n * convert base64/URLEncoded data component to raw binary data held in a string\n * @param  {string} dataURI base64/URLEncoded data\n * @return {string}         raw binary data\n */\nfunction dataURItoBlob(dataURI) {\n\tvar byteString = ''\n\tif (dataURI.split(',')[0].indexOf('base64') >= 0) {\n\t\tbyteString = atob(dataURI.split(',')[1])\n\t}\n\telse {\n\t\tbyteString = unescape(dataURI.split(',')[1])\n\t}\n\n\t// separate out the mime component\n\tvar mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0]\n\n\t// write the bytes of the string to a typed array\n\tvar ia = new Uint8Array(byteString.length)\n\tfor (var i = 0; i < byteString.length; i++) {\n\t\tia[i] = byteString.charCodeAt(i)\n\t}\n\treturn new Blob([ia], {type: mimeString})\n}\n\nmodule.exports = compress\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],3:[function(require,module,exports){\n(function (global){\n/*\n * Base on arale/upload\n * error message: 'upload error: xxxx' (mostly)\n * error will call settings.error function\n */\n\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nvar compress = require('./compress')\n\nES6Promise.polyfill()\nvar iframeCount = 0\nvar uid = 0\n\n/**\n * Upload constructor\n * @param {Object} options config\n */\nfunction Upload(options) {\n\tif (!(this instanceof Upload)) {\n\t\treturn new Upload(options)\n\t}\n\tif (typeof options !== 'object') {\n\t\toptions = {}\n\t}\n\tvar settings = {\n\t\ttrigger: null,\n\t\tname: 'file',\n\t\taction: '/upload',\n\t\taccept: null,\n\t\tdata: null,\n\t\tmultiple: true,\n\t\tselect: null,\n\t\terror: null,\n\t\tsuccess: null,\n\t\tprogress: null,\n\t\tcompress: false,\n\t\ttimeout: null\n\t}\n\t$.extend(settings, options)\n\tthis.settings = settings\n\tif (!$(this.settings.trigger).length) {\n\t\tthrow Error('config error: trigger invalid')\n\t}\n\n\tthis.setup()\n\tthis.bind()\n}\n\n/**\n * init form that contains hidden data input and transparency file input\n */\nUpload.prototype.setup = function () {\n\tthis.form = $('<form></from>').attr({\n\t\tmethod: 'post',\n\t\tenctype: 'multipart/form-data',\n\t\taction: this.settings.action\n\t})\n\tthis.form.append(createInputs(this.settings.data))\n\n\tthis.input = $('<input></input>').attr({\n\t\ttype: 'file',\n\t\tname: this.settings.name,\n\t\taccept: this.settings.accept || '',\n\t\tmultiple: !!this.settings.multiple\n\t})\n\tvar $trigger = $(this.settings.trigger)\n\tvar outerWidth = $trigger.outerWidth ?  $trigger.outerWidth() : $trigger[0].offsetWidth\n\tvar outerHeight = $trigger.outerHeight ?  $trigger.outerHeight() : $trigger[0].offsetHeight\n\tthis.input.attr('hidefocus', true).css({\n\t\tposition: 'absolute',\n\t\tleft: 0,\n\t\ttop: 0,\n\t\twidth: outerWidth,\n\t\theight: outerHeight,\n\t\topacity: 0,\n\t\toutline: 0,\n\t\tcursor: 'pointer'\n\t})\n\tthis.form.append(this.input)\n\tthis.form.css({\n\t\tposition: 'absolute',\n\t\ttop: $trigger.offset().top,\n\t\tleft: $trigger.offset().left,\n\t\twidth: outerWidth,\n\t\theight: outerHeight,\n\t\toverflow: 'hidden',\n\t\tzIndex: findzIndex($trigger) + 10\n\t}).appendTo('body')\n}\n\n/**\n * bind the trigger element to form\n */\nUpload.prototype.bind = function () {\n\tvar self = this\n\tvar $trigger = $(self.settings.trigger)\n\tvar outerWidth = $trigger.outerWidth ?  $trigger.outerWidth() : $trigger[0].offsetWidth\n\tvar outerHeight = $trigger.outerHeight ?  $trigger.outerHeight() : $trigger[0].offsetHeight\n\t$trigger.on('mouseenter', function () {\n\t\tself.form.css({\n\t\t\ttop: $trigger.offset().top,\n\t\t\tleft: $trigger.offset().left,\n\t\t\twidth: outerWidth,\n\t\t\theight: outerHeight\n\t\t}).show()\n\t})\n\tself.bindInput()\n}\n\n/**\n * handle file input change event\n */\nUpload.prototype.bindInput = function () {\n\tvar self = this\n\tself.files = []\n\n\tself.input.on('change', function(e) {\n\n\t\t// ie9- don't support FileList Object\n\t\tself.files = this.files || [{\n\t\t\tname: e.target.value.split('\\\\').pop()\n\t\t}]\n\t\tself.uids = $.map(self.files, function (file, index) {\n\t\t\treturn uid++\n\t\t})\n\t\tif (self.settings.select) {\n\t\t\tself.settings.select.call(self, self.files, self.uids)\n\t\t} else {\n\t\t\tself.submit()\n\t\t}\n\t})\n}\n\n/**\n * upload file to server\n * use ajax or form\n * refresh file input when trigger submit\n * @return {Promise}   upload completed primise\n */\nUpload.prototype.submit = function () {\n\tvar self = this\n\tvar promise = null\n\tif (window.FormData) {\n\t\tpromise = self.ajaxSubmit(self.files, self.uids)\n\t} else {\n\t\tpromise = self.formSubmit(self.uids[0])\n\t}\n\tself.refreshInput()\n\n\t// hide form, avoid trigger position vary\n\treturn promise.then(function () {\n\t\tself.form.hide()\n\t})\n}\n\n/**\n * upload file by ajax\n * it will be compressed\n * success or error will trigger callback function\n * @param  {Array}   files   upload files\n * @param  {Array}   uids    the files's uids\n * @return {Promise}         upload completed promise\n */\nUpload.prototype.ajaxSubmit = function (files, uids) {\n\tvar self = this\n\n\t// upyun server do not support multiple files upload\n\tvar promiseArr = []\n\t$.each(files, function (index, file) {\n\t\tvar promise = compress(file, self.settings.compress)['catch'](function (err) {\n\n\t\t\t// compress error then go on uploading\n\t\t\treturn file\n\t\t}).then(function (blob) {\n\n\t\t\t// add data and file\n\t\t\tself.input.prop('disabled', true)\n\t\t\tvar form = new FormData(self.form.get(0))\n\t\t\tform.append(self.settings.name, blob, file.name)\n\t\t\tself.input.prop('disabled', false)\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t$.ajax({\n\t\t\t\t\turl: self.settings.action,\n\t\t\t\t\ttype: 'post',\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\tdata: form,\n\t\t\t\t\ttimeout: self.settings.timeout,\n\t\t\t\t\txhr: function () {\n\t\t\t\t\t\tvar xhr = $.ajaxSettings.xhr()\n\t\t\t\t\t\tif (xhr.upload && self.settings.progress) {\n\t\t\t\t\t\t\txhr.upload.addEventListener('progress', function(event) {\n\t\t\t\t\t\t\t\tvar percent = 0\n\t\t\t\t\t\t\t\tvar position = event.loaded || event.position\n\t\t\t\t\t\t\t\tvar total = event.total\n\t\t\t\t\t\t\t\tif (event.lengthComputable) {\n\t\t\t\t\t\t\t\t\tpercent = Math.ceil(position / total * 100)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tself.settings.progress(position, total, percent, self.uids[index])\n\t\t\t\t\t\t\t}, false)\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn xhr\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: function (data) {\n\t\t\t\t\t\tresolve(data)\n\t\t\t\t\t},\n\t\t\t\t\terror: function (xhr, textStatus, errorThrown) {\n\t\t\t\t\t\tif (errorThrown) {\n\t\t\t\t\t\t\terrorThrown = ' ' + errorThrown\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar message = 'upload error: ' + textStatus + errorThrown\n\t\t\t\t\t\treject(new Error(message))\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t}).then(function (data) {\n\n\t\t\t// upload success\n\t\t\tif (self.settings.success) {\n\t\t\t\tself.settings.success(data, uids[index])\n\t\t\t}\n\t\t}, function (err) {\n\n\t\t\t// upload error\n\t\t\tif (self.settings.error) {\n\t\t\t\tself.settings.error(err, uids[index])\n\t\t\t}\n\t\t})\n\t\tpromiseArr.push(promise)\n\t})\n\treturn Promise.all(promiseArr)\n}\n\n/**\n * upload file by form submit\n * success or error will trigger callback function\n * @param  {number}   uid  file uid\n * @return {Promise}       upload completed promise\n */\nUpload.prototype.formSubmit = function (uid) {\n\tvar self = this\n\n\treturn new Promise(function (resolve, reject) {\n\n\t\t// combine form and iframe\n\t\tself.iframe = newIframe()\n\t\tself.form.attr('target', self.iframe.attr('name'))\n\t\t$('body').append(self.iframe)\n\n\t\t// bind iframe load event\n\t\tvar timer = null\n\t\tself.iframe.one('load', function () {\n\n\t\t\t// has timeout\n\t\t\tif (timer === null) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// timer exist\n\t\t\tif (timer !== undefined) {\n\t\t\t\tclearTimeout(timer)\n\t\t\t}\n\n\t\t\t// Fix for IE endless progress bar activity bug (happens on form submits to iframe targets)\n\t\t\t$('<iframe src=\"javascript:false;\"></iframe>')\n\t\t\t\t.appendTo(self.form)\n\t\t\t\t.remove()\n\n\t\t\t// cross domain try/catch\n\t\t\ttry {\n\t\t\t\tvar response = $.trim($(this).contents().find(\"body\").html())\n\t\t\t} catch (err) {\n\t\t\t\treject(new Error('upload error: cross domain'))\n\t\t\t}\n\t\t\tresolve(response)\n\t\t})\n\t\tself.form.submit()\n\n\t\t// add timer\n\t\tif (self.settings.timeout > 0) {\n\t\t\ttimer = setTimeout(function () {\n\t\t\t\treject(new Error('upload error: timeout'))\n\t\t\t\ttimer = null\n\t\t\t}, self.settings.timeout)\n\t\t} else {\n\t\t\ttimer = undefined\n\t\t}\n\t}).then(function (data) {\n\n\t\t// upload success\n\t\tif (self.settings.success) {\n\t\t\tself.settings.success(data, uid)\n\t\t}\n\t}, function (err) {\n\n\t\t// upload error\n\t\tif (self.settings.error) {\n\t\t\tself.settings.error(err, uid)\n\t\t}\n\t}).then(function () {\n\n\t\t// upload finished then remove iframe\n\t\tself.iframe.remove()\n\t})\n}\n\n/**\n * update the input element\n * or the same file can not upload\n */\nUpload.prototype.refreshInput = function () {\n\tvar newInput = this.input.clone()\n\tthis.input.before(newInput)\n\tthis.input.off('change')\n\tthis.input.remove()\n\tthis.input = newInput\n\tthis.bindInput()\n}\n\n/**\n * set settings.select\n * @param  {Function} callback override settings.select\n * @return {Object}            upload object\n */\nUpload.prototype.select = function (callback) {\n\tif (!callback) {\n\t\treturn this\n\t}\n\tthis.settings.select = callback\n\treturn this\n}\n\n/**\n * set settings.success\n * @param  {Function} callback override settings.success\n * @return {Object}            upload object\n */\nUpload.prototype.success = function (callback) {\n\tif (!callback) {\n\t\treturn this\n\t}\n\tthis.settings.success = callback\n\treturn this\n}\n\n/**\n * set settings.error\n * @param  {Function} callback override settings.error\n * @return {Object}            upload object\n */\nUpload.prototype.error = function (callback) {\n\tif (!callback) {\n\t\treturn this\n\t}\n\tthis.settings.error = callback\n\treturn this\n}\n\n/**\n * set settings.progress\n * @param  {Function} callback override settings.progress\n * @return {Object}            upload object\n */\nUpload.prototype.progress = function (callback) {\n\tif (!callback) {\n\t\treturn this\n\t}\n\tthis.settings.progress = callback\n\treturn this\n}\n\n/**\n * create hidden input for data\n * @param  {Object} data settings.data\n * @return {Array}       array of hidden input\n */\nfunction createInputs(data) {\n\tif (!data) return []\n\treturn $.map(data, function (value, key) {\n\t\treturn $('<input></input>').attr({\n\t\t\ttype: 'hidden',\n\t\t\tname: key,\n\t\t\tvalue: value\n\t\t})\n\t})\n}\n\n/**\n * find the parents' max zIndex\n * @param  {jQueryElement} $node\n * @return {number}               parents max_zIndex\n */\nfunction findzIndex($node) {\n\tvar zIndex = 0\n\t$.each($node.parents(), function (index, item) {\n\t\tif (item === $('body')[0]) {\n\t\t\treturn false\n\t\t}\n\t\tif ($(item).css('position') !== 'static') {\n\t\t\tzIndex = parseInt($(item).css('zIndex'), 10) || zIndex\n\t\t}\n\t})\n\treturn zIndex\n}\n\n/**\n * create new iframe when trigger form submit\n * @return {jQueryElement} iframe element of jQuery\n */\nfunction newIframe() {\n\treturn $('<iframe></iframe>').attr({\n\t\tname: 'iframe-Upload-' + iframeCount++\n\t}).hide()\n}\n\nmodule.exports = Upload\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./compress\":2}],4:[function(require,module,exports){\n(function (global){\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nES6Promise.polyfill()\n\n// err message: 'server_config error: xxxx'\n\n/**\n * get Json via ajax\n * @param  {string} url  the server url\n * @param  {Object} data query data\n * @return {Promise}     promise resolve message\n */\nfunction getJson(url, data) {\n\treturn new Promise(function (resolve, reject) {\n\t\t$.ajax({\n\t\t\turl: url,\n\t\t\tdata: data,\n\t\t\tdataType: 'json',\n\t\t\tsuccess: function (response) {\n\t\t\t\tif (response.success) {\n\t\t\t\t\tresolve(response.message)\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error('server_config error: ' + response.message))\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (xhr, textStatus, errorThrown) {\n\t\t\t\tif (errorThrown) {\n\t\t\t\t\terrorThrown = ' ' + errorThrown\n\t\t\t\t}\n\t\t\t\treject(new Error('server_config error: ' + textStatus + errorThrown))\n\t\t\t}\n\t\t})\n\t})\n}\n\n/**\n * get server config\n * @param  {string} type   'image/media'\n * @param  {string} vendor 'upyun/qiniu/upyun_im'\n * @return {Promise}        promise resolve server config\n */\nfunction getConfig(type, vendor) {\n\tif (type === 'image') {\n\t\tif (!window.location.origin) {\n\t\t\twindow.location.origin = window.location.protocol + \"//\" +\n\t\t\t\twindow.location.hostname + (window.location.port ? ':' +\n\t\t\t\twindow.location.port: '')\n\t\t}\n\t\tvar url = window.location.origin + '/imageUpload/getConfig/'\n\t\tvar query = {\n\t\t\tvendor: vendor,\n\t\t\t'return-url': window.location.origin + '/imageUpload/getResult/'\n\t\t}\n\t\tif (window.FormData) {\n\t\t\tdelete query['return-url']\n\t\t}\n\t\tvar cache = window[vendor.toUpperCase()]\n\t\tif (cache) {\n\t\t\treturn Promise.resolve({\n\t\t\t\taction: cache.uploadUrl,\n\t\t\t\tdata: cache.uploadParams,\n\t\t\t\tname: cache.fileKey\n\t\t\t})\n\t\t} else {\n\t\t\treturn getJson(url, query).then(function (response) {\n\t\t\t\twindow[vendor.toUpperCase()] = response\n\t\t\t\treturn {\n\t\t\t\t\taction: response.uploadUrl,\n\t\t\t\t\tdata: response.uploadParams,\n\t\t\t\t\tname: response.fileKey\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\treturn Promise.reject(new Error('server_config error: ' + 'media type invalid'))\n}\n\nmodule.exports = getConfig\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}]},{},[1]);\n"],"sourceRoot":"/source/"}