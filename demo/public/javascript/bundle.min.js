!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.ImageUpload=t()}}(function(){return function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return r(n?n:t)},l,l.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e){function n(t,e){return $.isPlainObject(t)&&(e=t,t="upyun"),$.isPlainObject(e)||(e={}),t=t||"upyun",e=e||{},r.getConfig("image",t).then(function(t){return $.extend(e,t),new i(e)})}var i=t("./lib/upload"),r=t("./lib/vendor");n.getPath=function(t,e){return r.getPath("image",t,e)},e.exports=n},{"./lib/upload":3,"./lib/vendor":4}],2:[function(t,e){(function(t){"use strict";function n(t,e){return window.File&&window.FileReader&&window.URL&&e!==!1&&/image/i.test(t.type)?(e=e||{},new Promise(function(n){var o=new FileReader;o.readAsArrayBuffer(t),o.onload=function(o){var s=new Blob([o.target.result]);window.URL=window.URL||window.webkitURL;var a=window.URL.createObjectURL(s),u=new Image;u.src=a,u.onload=function(){var o=i(u,t.type,e),s=r(o);n(s)}}})):Promise.resolve(t)}function i(t,e,n){var i=t.width,r=t.height,o=n.max_width||i,s=n.max_height||r,a=n.quality||.7;i>r?i>o&&(r=Math.round(r*=o/i),i=o):r>s&&(i=Math.round(i*=s/r),r=s);var u=document.createElement("canvas");u.width=i,u.height=r;var f=u.getContext("2d");return f.drawImage(t,0,0,i,r),u.toDataURL(e,a)}function r(t){var e="";e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var n=t.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(e.length),r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return new Blob([i],{type:n})}var o="undefined"!=typeof window?window.ES6Promise:"undefined"!=typeof t?t.ES6Promise:null;o.polyfill(),e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(t,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);$.isPlainObject(t)||(t={});var e={trigger:null,name:"file",action:"/upload",accept:null,data:null,multiple:!0,change:null,error:null,success:null,progress:null,suffix:null,compress:null};$.extend(e,t),this.settings=e,this.setup(),this.bind()}function i(t){if(!t)return[];var e,n=[];for(var i in t)e=document.createElement("input"),e.type="hidden",e.name=i,e.value=t[i],n.push(e);return n}function r(t){for(var e=t.parentsUntil("body"),n=0,i=0;i<e.length;i++){var r=e.eq(i);"static"!==r.css("position")&&(n=parseInt(r.css("zIndex"),10)||n)}return n}function o(){var t="iframe-Upload-"+a,e=$('<iframe name="'+t+'" />').hide();return a+=1,e}var s=t("./compress"),a=0;n.prototype.setup=function(){this.form=$('<form method="post" enctype="multipart/form-data"target="" action="'+this.settings.action+'" />');var t=this.settings.data;this.form.append(i(t));var e=document.createElement("input");e.type="file",e.name=this.settings.name,this.settings.accept&&(e.accept=this.settings.accept),this.settings.multiple&&(e.multiple=!0,e.setAttribute("multiple","multiple")),this.input=$(e);var n=$(this.settings.trigger);return this.input.attr("hidefocus",!0).css({position:"absolute",top:0,right:0,opacity:0,outline:0,cursor:"pointer",height:n.outerHeight(),fontSize:Math.max(64,5*n.outerHeight())}),this.form.append(this.input),this.form.css({position:"absolute",top:n.offset().top,left:n.offset().left,overflow:"hidden",width:n.outerWidth(),height:n.outerHeight(),zIndex:r(n)+10}).appendTo("body"),this},n.prototype.bind=function(){var t=this,e=$(t.settings.trigger);e.mouseenter(function(){t.form.css({top:e.offset().top,left:e.offset().left,width:e.outerWidth(),height:e.outerHeight()})}),t.bindInput()},n.prototype.bindInput=function(){var t=this;t.files=[],t.input.change(function(e){t.files=[];var n=this.files||[{name:e.target.value.split("\\").pop()}];if(t.settings.suffix){var i=t.settings.suffix.split(",");i=$.map(i,function(t){return $.trim(t)});for(var r=0;r<n.length;r++)-1!==$.inArray(n[r].name.split(".").pop(),i)?t.files.push(n[r]):t.settings.error&&t.settings.error(new Error("suffix error"),n[r].name)}t.files.length&&(t.settings.change?t.settings.change.call(t,t.files):t.submit())})},n.prototype.submit=function(){window.FormData?this.ajaxSubmit():this.formSubmit()},n.prototype.ajaxSubmit=function(){var t=this,e=t.files;t.input.prop("disabled",!0);var n=new FormData(t.form.get(0));t.input.prop("disabled",!1);for(var i=0;i<e.length;i++)!function(e){s(e,t.settings.compress)["catch"](function(n){t.settings.error&&t.settings.error(new Error("compress error: "+n.message),e.name)}).then(function(i){i=i||e,n.append(t.settings.name,i,e.name),$.ajax({url:t.settings.action,type:"post",processData:!1,contentType:!1,data:n,xhr:function(){var n=$.ajaxSettings.xhr();return n.upload&&t.settings.progress&&n.upload.addEventListener("progress",function(n){var i=0,r=n.loaded||n.position,o=n.total;n.lengthComputable&&(i=Math.ceil(r/o*100)),t.settings.progress(n,r,o,i,e.name)},!1),n},success:function(n){t.settings.success&&t.settings.success(n,e.name)},error:function(n,i,r){t.settings.error&&t.settings.error(new Error("upload error: "+r),e.name)}})})}(e[i])},n.prototype.formSubmit=function(){var t=this;t.iframe=o(),t.form.attr("target",t.iframe.attr("name")),t.iframe.data("fileName",t.files[0].name),$("body").append(t.iframe),t.iframe.one("load",function(){$('<iframe src="javascript:false;"></iframe>').appendTo(t.form).remove();var e="";try{e=$.trim($(this).contents().find("body").html())}catch(n){t.settings.error&&t.settings.error(new Error("cross_domain error"),$(this).data("fileName"))}e&&t.settings.success&&t.settings.success(e,$(this).data("fileName")),t.iframe.remove()}),t.form.submit()},n.prototype.refreshInput=function(){var t=this.input.clone();this.input.before(t),this.input.off("change"),this.input.remove(),this.input=t,this.bindInput()},n.prototype.change=function(t){return t?(this.settings.change=t,this):this},n.prototype.success=function(t){var e=this;return this.settings.success=function(n,i){e.refreshInput(),t&&t(n,i)},this},n.prototype.error=function(t){var e=this;return this.settings.error=function(n,i){t&&(e.refreshInput(),t(n,i))},this},n.prototype.progress=function(t){return t?(this.settings.progress=t,this):this},e.exports=n},{"./compress":2}],4:[function(t,e,n){(function(t){"use strict";var e="undefined"!=typeof window?window.ES6Promise:"undefined"!=typeof t?t.ES6Promise:null;e.polyfill();var i=function(t,e){return new Promise(function(n,i){$.ajax({url:t,data:e,dataType:"json",success:function(t){t.success?n(t.message):i(new Error("server_config error: "+t.message))},error:function(t,e,n){i(new Error("server_config error: "+n))}})})};n.getConfig=function(t,e){if("image"===t){window.location.origin=window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");var n=window.location.origin+"/ImageUpload/getConfig/",r={vendor:e,"return-url":window.location.origin+"/ImageUpload/getResult/"};return window.FormData&&delete r["return-url"],i(n,r).then(function(t){return{action:t.uploadUrl,data:t.uploadParams,name:t.fileKey}})}return Promise.reject(new Error("server_config error: media type invalid"))},n.getPath=function(t,e,n){if("image"===t){if(e=$.parseJSON(e),e.code>=200&&e.code<300){var i=e.url.replace(/\.$/,"");i=i.split(".");var t=i[1]?"."+i[1]:"";return i=i[0],n=n?"_"+n:"_sq",-1!==i.indexOf("#")&&(t=i.split("#")[0]),"http://img"+(i.charCodeAt(1)%3+4)+".baixing.net"+i+t+n}return null}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});
//# sourceMappingURL=bundle.min.js.map