{"version":3,"sources":["upload.min.js"],"names":["e","exports","module","define","amd","f","window","global","self","Upload","t","n","r","s","o","u","a","require","i","Error","code","l","call","length",1,"options","this","settings","trigger","name","action","accept","data","multiple","select","error","success","progress","compress","timeout","$","extend","setup","bind","createInputs","map","value","key","attr","type","findzIndex","$node","zIndex","each","parents","index","item","css","parseInt","newIframe","iframeCount","hide","ES6Promise","polyfill","uid","prototype","form","method","enctype","append","input","$trigger","outerWidth","offsetWidth","outerHeight","offsetHeight","position","left","top","width","height","opacity","outline","cursor","offset","overflow","appendTo","mouseenter","show","bindInput","files","on","target","split","pop","uids","submit","promise","FormData","ajaxSubmit","formSubmit","refreshInput","then","promiseArr","file","blob","prop","get","Promise","resolve","reject","ajax","url","processData","contentType","xhr","ajaxSettings","upload","addEventListener","event","percent","loaded","total","lengthComputable","Math","ceil","textStatus","errorThrown","message","err","push","all","iframe","timer","one","undefined","clearTimeout","remove","response","trim","contents","find","html","setTimeout","newInput","clone","before","off","callback","./compress",2,"File","FileReader","URL","test","reader","readAsArrayBuffer","onload","Blob","result","webkitURL","blobURL","createObjectURL","image","Image","src","dataURI","resize","dataURItoBlob","img","max_width","max_height","quality","round","canvas","document","createElement","ctx","getContext","drawImage","toDataURL","byteString","indexOf","atob","unescape","mimeString","ia","Uint8Array","charCodeAt"],"mappings":"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","file":"upload.min.js","sourcesContent":["!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var f;\"undefined\"!=typeof window?f=window:\"undefined\"!=typeof global?f=global:\"undefined\"!=typeof self&&(f=self),f.Upload=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n(function (global){\n/*\n * Base on arale/upload\n * error message: 'upload error: xxxx' (mostly)\n * error will call settings.error function\n */\n\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nvar compress = require('./compress')\n\nES6Promise.polyfill()\nvar iframeCount = 0\nvar uid = 0\n\n/**\n * Upload constructor\n * @param {Object} options config\n */\nfunction Upload(options) {\n    if (!(this instanceof Upload)) {\n        return new Upload(options)\n    }\n    if (typeof options !== 'object') {\n        options = {}\n    }\n    var settings = {\n        trigger: null,\n        name: 'file',\n        action: '/upload',\n        accept: null,\n        data: null,\n        multiple: true,\n        select: null,\n        error: null,\n        success: null,\n        progress: null,\n        compress: false,\n        timeout: null\n    }\n    $.extend(settings, options)\n    this.settings = settings\n    if (!$(this.settings.trigger).length) {\n        throw Error('config error: trigger invalid')\n    }\n\n    this.setup()\n    this.bind()\n}\n\n/**\n * init form that contains hidden data input and transparency file input\n */\nUpload.prototype.setup = function () {\n    this.form = $('<form></from>').attr({\n        method: 'post',\n        enctype: 'multipart/form-data',\n        action: this.settings.action\n    })\n    this.form.append(createInputs(this.settings.data))\n\n    this.input = $('<input></input>').attr({\n        type: 'file',\n        name: this.settings.name,\n        accept: this.settings.accept || '',\n        multiple: !!this.settings.multiple\n    })\n    var $trigger = $(this.settings.trigger)\n    var outerWidth = $trigger.outerWidth ?  $trigger.outerWidth() : $trigger[0].offsetWidth\n    var outerHeight = $trigger.outerHeight ?  $trigger.outerHeight() : $trigger[0].offsetHeight\n    this.input.attr('hidefocus', true).css({\n        position: 'absolute',\n        left: 0,\n        top: 0,\n        width: outerWidth,\n        height: outerHeight,\n        opacity: 0,\n        outline: 0,\n        cursor: 'pointer'\n    })\n    this.form.append(this.input)\n    this.form.css({\n        position: 'absolute',\n        top: $trigger.offset().top,\n        left: $trigger.offset().left,\n        width: outerWidth,\n        height: outerHeight,\n        overflow: 'hidden',\n        zIndex: findzIndex($trigger) + 10\n    }).appendTo('body')\n}\n\n/**\n * bind the trigger element to form\n */\nUpload.prototype.bind = function () {\n    var self = this\n    var $trigger = $(self.settings.trigger)\n    var outerWidth = $trigger.outerWidth ?  $trigger.outerWidth() : $trigger[0].offsetWidth\n    var outerHeight = $trigger.outerHeight ?  $trigger.outerHeight() : $trigger[0].offsetHeight\n    $trigger.mouseenter(function () {\n        self.form.css({\n            top: $trigger.offset().top,\n            left: $trigger.offset().left,\n            width: outerWidth,\n            height: outerHeight\n        }).show()\n    })\n    self.bindInput()\n}\n\n/**\n * handle file input change event\n */\nUpload.prototype.bindInput = function () {\n    var self = this\n    self.files = []\n\n    self.input.on('change', function(e) {\n\n        // ie9- don't support FileList Object\n        self.files = this.files || [{\n            name: e.target.value.split('\\\\').pop()\n        }]\n        self.uids = $.map(self.files, function (file, index) {\n            return uid++\n        })\n        if (self.settings.select) {\n            self.settings.select.call(self, self.files, self.uids)\n        } else {\n            self.submit()\n        }\n    })\n}\n\n/**\n * upload file to server\n * use ajax or form\n * refresh file input when trigger submit\n * @return {Promise}   upload completed primise\n */\nUpload.prototype.submit = function () {\n    var self = this\n    var promise = null\n    if (window.FormData) {\n        promise = self.ajaxSubmit(self.files, self.uids)\n    } else {\n        promise = self.formSubmit(self.uids[0])\n    }\n    self.refreshInput()\n\n    // hide form, avoid trigger position vary\n    return promise.then(function () {\n        self.form.hide()\n    })\n}\n\n/**\n * upload file by ajax\n * it will be compressed\n * success or error will trigger callback function\n * @param  {Array}   files   upload files\n * @param  {Array}   uids    the files's uids\n * @return {Promise}         upload completed promise\n */\nUpload.prototype.ajaxSubmit = function (files, uids) {\n    var self = this\n\n    // upyun server do not support multiple files upload\n    var promiseArr = []\n    $.each(files, function (index, file) {\n        var promise = compress(file, self.settings.compress)['catch'](function (err) {\n\n            // compress error then go on uploading\n            return file\n        }).then(function (blob) {\n\n            // add data and file\n            self.input.prop('disabled', true)\n            var form = new FormData(self.form.get(0))\n            form.append(self.settings.name, blob, file.name)\n            self.input.prop('disabled', false)\n            return new Promise(function (resolve, reject) {\n                $.ajax({\n                    url: self.settings.action,\n                    type: 'post',\n                    processData: false,\n                    contentType: false,\n                    data: form,\n                    timeout: self.settings.timeout,\n                    xhr: function () {\n                        var xhr = $.ajaxSettings.xhr()\n                        if (xhr.upload && self.settings.progress) {\n                            xhr.upload.addEventListener('progress', function(event) {\n                                var percent = 0\n                                var position = event.loaded || event.position\n                                var total = event.total\n                                if (event.lengthComputable) {\n                                    percent = Math.ceil(position / total * 100)\n                                }\n                                self.settings.progress(position, total, percent, self.uids[index])\n                            }, false)\n                        }\n                        return xhr\n                    },\n                    success: function (data) {\n                        resolve(data)\n                    },\n                    error: function (xhr, textStatus, errorThrown) {\n                        if (errorThrown) {\n                            errorThrown = ' ' + errorThrown\n                        }\n                        var message = 'upload error: ' + textStatus + errorThrown\n                        reject(new Error(message))\n                    }\n                })\n            })\n        }).then(function (data) {\n\n            // upload success\n            if (self.settings.success) {\n                self.settings.success(data, uids[index])\n            }\n        }, function (err) {\n\n            // upload error\n            if (self.settings.error) {\n                self.settings.error(err, uids[index])\n            }\n        })\n        promiseArr.push(promise)\n    })\n    return Promise.all(promiseArr)\n}\n\n/**\n * upload file by form submit\n * success or error will trigger callback function\n * @param  {number}   uid  file uid\n * @return {Promise}       upload completed promise\n */\nUpload.prototype.formSubmit = function (uid) {\n    var self = this\n\n    return new Promise(function (resolve, reject) {\n\n        // combine form and iframe\n        self.iframe = newIframe()\n        self.form.attr('target', self.iframe.attr('name'))\n        $('body').append(self.iframe)\n\n        // bind iframe load event\n        var timer = null\n        self.iframe.one('load', function () {\n\n            // has timeout\n            if (timer === null) {\n                return\n            }\n\n            // timer exist\n            if (timer !== undefined) {\n                clearTimeout(timer)\n            }\n\n            // Fix for IE endless progress bar activity bug (happens on form submits to iframe targets)\n            $('<iframe src=\"javascript:false;\"></iframe>')\n                .appendTo(self.form)\n                .remove()\n\n            // cross domain try/catch\n            try {\n                var response = $.trim($(this).contents().find(\"body\").html())\n            } catch (err) {\n                reject(new Error('upload error: cross domain'))\n            }\n            resolve(response)\n        })\n        self.form.submit()\n\n        // add timer\n        if (self.settings.timeout > 0) {\n            timer = setTimeout(function () {\n                reject(new Error('upload error: timeout'))\n                timer = null\n            }, self.settings.timeout)\n        } else {\n            timer = undefined\n        }\n    }).then(function (data) {\n\n        // upload success\n        if (self.settings.success) {\n            self.settings.success(data, uid)\n        }\n    }, function (err) {\n\n        // upload error\n        if (self.settings.error) {\n            self.settings.error(err, uid)\n        }\n    }).then(function () {\n\n        // upload finished then remove iframe\n        self.iframe.remove()\n    })\n}\n\n/**\n * update the input element\n * or the same file can not upload\n */\nUpload.prototype.refreshInput = function () {\n    var newInput = this.input.clone()\n    this.input.before(newInput)\n    this.input.off('change')\n    this.input.remove()\n    this.input = newInput\n    this.bindInput()\n}\n\n/**\n * set settings.select\n * @param  {Function} callback override settings.select\n * @return {Object}            upload object\n */\nUpload.prototype.select = function (callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.select = callback\n    return this\n}\n\n/**\n * set settings.success\n * @param  {Function} callback override settings.success\n * @return {Object}            upload object\n */\nUpload.prototype.success = function (callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.success = callback\n    return this\n}\n\n/**\n * set settings.error\n * @param  {Function} callback override settings.error\n * @return {Object}            upload object\n */\nUpload.prototype.error = function (callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.error = callback\n    return this\n}\n\n/**\n * set settings.progress\n * @param  {Function} callback override settings.progress\n * @return {Object}            upload object\n */\nUpload.prototype.progress = function (callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.progress = callback\n    return this\n}\n\n/**\n * create hidden input for data\n * @param  {Object} data settings.data\n * @return {Array}       array of hidden input\n */\nfunction createInputs(data) {\n    if (!data) return []\n    return $.map(data, function (value, key) {\n        return $('<input></input>').attr({\n            type: 'hidden',\n            name: key,\n            value: value\n        })\n    })\n}\n\n/**\n * find the parents' max zIndex\n * @param  {jQueryElement} $node\n * @return {number}               parents max_zIndex\n */\nfunction findzIndex($node) {\n    var zIndex = 0\n    $.each($node.parents(), function (index, item) {\n        if (item === $('body')[0]) {\n            return false\n        }\n        if ($(item).css('position') !== 'static') {\n            zIndex = parseInt($(item).css('zIndex'), 10) || zIndex\n        }\n    })\n    return zIndex\n}\n\n/**\n * create new iframe when trigger form submit\n * @return {jQueryElement} iframe element of jQuery\n */\nfunction newIframe() {\n    return $('<iframe></iframe>').attr({\n        name: 'iframe-Upload-' + iframeCount++\n    }).hide()\n}\n\nmodule.exports = Upload\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./compress\":2}],2:[function(require,module,exports){\n(function (global){\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nES6Promise.polyfill()\n\n/**\n * compress (now only support image)\n * @param  {File}    file\n * @param  {object}  options {max_width, max_height, quality}\n * @return {Promise}\n */\nfunction compress(file, options) {\n\n    // do not need to compress\n    if (options === false) {\n        return Promise.resolve(file)\n    }\n\n    // check File API support\n    if (!window.File || !window.FileReader || !window.URL) {\n        return Promise.reject(new Error('File API not support'))\n    }\n\n    // check file param\n    if (!(file instanceof File)) {\n        return Promise.reject(new Error('file invalid'))\n    }\n\n    // can not compress\n    if (!(/image/i).test(file.type)) {\n        return Promise.reject(new Error('file is not image'))\n    }\n    if (typeof options !== 'object') {\n        options = {}\n    }\n    return new Promise(function (resolve, reject) {\n\n        // read the files\n        var reader = new FileReader()\n        reader.readAsArrayBuffer(file)\n        reader.onload = function (event) {\n\n            // blob stuff\n            try {\n                var blob = new Blob([event.target.result])\n                window.URL = window.URL || window.webkitURL\n                var blobURL = window.URL.createObjectURL(blob)\n\n                // helper Image object\n                var image = new Image()\n                image.src = blobURL\n                image.onload = function() {\n\n                    // send it to canvas\n                    try {\n                        var dataURI = resize(image, file.type, options)\n                        var blob = dataURItoBlob(dataURI)\n                        resolve(blob)\n                    } catch (err) {\n                        reject(err)\n                    }\n                }\n            } catch (err) {\n                reject(err)\n            }\n        }\n    })\n}\n\n/**\n * resize Image through canvas\n * @param  {Image}  img      DOM Element\n * @param  {string} type     MIME-STRING\n * @param  {number} options  {max_width, max_height, quality}\n * @return {string}          base64/URLEncoded data\n */\nfunction resize(img, type, options) {\n    var width = img.width\n    var height = img.height\n    var max_width = options.max_width || width\n    var max_height = options.max_height || height\n    var quality = options.quality || null\n\n    // calculate the width and height, constraining the proportions\n    if (width > height) {\n        if (width > max_width) {\n            height = Math.round(height *= max_width / width)\n            width = max_width\n        }\n    } else {\n        if (height > max_height) {\n            width = Math.round(width *= max_height / height)\n            height = max_height\n        }\n    }\n\n    // resize the canvas and draw the image data into it\n    var canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    var ctx = canvas.getContext(\"2d\")\n    ctx.drawImage(img, 0, 0, width, height)\n    return canvas.toDataURL(type, quality)\n}\n\n/**\n * convert base64/URLEncoded data component to raw binary data held in a string\n * @param  {string} dataURI base64/URLEncoded data\n * @return {string}         raw binary data\n */\nfunction dataURItoBlob(dataURI) {\n    var byteString = ''\n    if (dataURI.split(',')[0].indexOf('base64') >= 0) {\n        byteString = atob(dataURI.split(',')[1])\n    }\n    else {\n        byteString = unescape(dataURI.split(',')[1])\n    }\n\n    // separate out the mime component\n    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0]\n\n    // write the bytes of the string to a typed array\n    var ia = new Uint8Array(byteString.length)\n    for (var i = 0; i < byteString.length; i++) {\n        ia[i] = byteString.charCodeAt(i)\n    }\n    return new Blob([ia], {type: mimeString})\n}\n\nmodule.exports = compress\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}]},{},[1])(1)\n});"],"sourceRoot":"/source/"}