{"version":3,"sources":["bundle.min.js"],"names":["require","e","t","n","r","s","o","u","a","i","f","Error","code","l","exports","call","length",1,"module","global","compress","file","options","window","File","FileReader","URL","test","type","Promise","resolve","reader","readAsArrayBuffer","onload","event","blob","Blob","target","result","webkitURL","blobURL","createObjectURL","image","Image","src","dataURI","resize","dataURItoBlob","img","width","height","max_width","max_height","quality","Math","round","canvas","document","createElement","ctx","getContext","drawImage","toDataURL","byteString","split","indexOf","atob","unescape","mimeString","ia","Uint8Array","charCodeAt","ES6Promise","polyfill","this","self","upload","Uploader","isType","Object","settings","trigger","name","action","accept","data","multiple","change","error","success","progress","suffix","$","extend","setup","bind","obj","prototype","toString","createInputs","inputs","value","push","findzIndex","$node","parents","parentsUntil","zIndex","item","eq","css","parseInt","newIframe","iframeName","iframeCount","iframe","hide","form","append","input","setAttribute","$trigger","attr","position","top","right","opacity","outline","cursor","outerHeight","fontSize","max","offset","left","overflow","outerWidth","appendTo","mouseenter","bindInput","files","pop","submit","FormData","ajaxSubmit","formSubmit","prop","get","then","ajax","url","processData","contentType","xhr","ajaxSettings","addEventListener","percent","loaded","total","lengthComputable","ceil","textStatus","errorMsg","one","remove","response","trim","contents","find","html","refreshInput","newInput","clone","before","off","callback","me","fileName","./lib/compress","upyun","getJson","reject","message","getConfig","path","location","origin","protocol","hostname","port","policy","signature","bucket","config","getPath","parseJSON"],"mappings":"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","file":"bundle.min.js","sourcesContent":["require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n(function (global){\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nES6Promise.polyfill()\n\n/**\n * compress (now only support image)\n * @param  {File}    file\n * @param  {object}  options {max_width, max_height, quality}\n * @return {Promise}\n */\nfunction compress(file, options) {\n\n    // check File support\n    if (!window.File || !window.FileReader || !window.URL) {\n        return Promise.resolve(file)\n    }\n\n    // do not compress\n    if (options === false || !(/image/i).test(file.type)) {\n        return Promise.resolve(file)\n    }\n\n    options = options || {}\n    return new Promise(function (resolve, reject) {\n\n        // read the files\n        var reader = new FileReader()\n        reader.readAsArrayBuffer(file)\n        reader.onload = function (event) {\n\n            // blob stuff\n            var blob = new Blob([event.target.result])\n            window.URL = window.URL || window.webkitURL\n            var blobURL = window.URL.createObjectURL(blob)\n\n            // helper Image object\n            var image = new Image()\n            image.src = blobURL\n            image.onload = function() {\n\n                // send it to canvas\n                var dataURI = resize(image, file.type, options)\n                var blob = dataURItoBlob(dataURI)\n                resolve(blob)\n            }\n        }\n    })\n}\n\n/**\n * resize Image through canvas\n * @param  {Image}  img      DOM Element\n * @param  {string} type     MIME-STRING\n * @param  {number} options  {max_width, max_height, quality}\n * @return {string}          base64/URLEncoded data\n */\nfunction resize(img, type, options) {\n    var width = img.width\n    var height = img.height\n    var max_width = options.max_width || width\n    var max_height = options.max_height || height\n    var quality = options.quality || 0.7\n\n    // calculate the width and height, constraining the proportions\n    if (width > height) {\n        if (width > max_width) {\n            height = Math.round(height *= max_width / width)\n            width = max_width\n        }\n    } else {\n        if (height > max_height) {\n            width = Math.round(width *= max_height / height)\n            height = max_height\n        }\n    }\n\n    // resize the canvas and draw the image data into it\n    var canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    var ctx = canvas.getContext(\"2d\")\n    ctx.drawImage(img, 0, 0, width, height)\n    return canvas.toDataURL(type, quality)\n}\n\n/**\n * convert base64/URLEncoded data component to raw binary data held in a string\n * @param  {string} dataURI base64/URLEncoded data\n * @return {string}         raw binary data\n */\nfunction dataURItoBlob(dataURI) {\n    var byteString = ''\n    if (dataURI.split(',')[0].indexOf('base64') >= 0) {\n        byteString = atob(dataURI.split(',')[1])\n    }\n    else {\n        byteString = unescape(dataURI.split(',')[1])\n    }\n\n    // separate out the mime component\n    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0]\n\n    // write the bytes of the string to a typed array\n    var ia = new Uint8Array(byteString.length)\n    for (var i = 0; i < byteString.length; i++) {\n        ia[i] = byteString.charCodeAt(i)\n    }\n    return new Blob([ia], {type: mimeString})\n}\n\nmodule.exports = compress\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],\"upload\":[function(require,module,exports){\n/*\n * Base on arale/upload\n */\n\n'use strict'\n\nvar compress = require('./lib/compress')\nvar iframeCount = 0\n\nfunction Uploader(options) {\n    if (!(this instanceof Uploader)) {\n        return new Uploader(options)\n    }\n    if (isType(Object)(options)) {\n        return null\n    }\n    var settings = {\n        trigger: null,\n        name: 'file',\n        action: '/upload',\n        accept: null,\n        data: null,\n        multiple: true,\n        change: null,\n        error: null,\n        success: null,\n        progress: null,\n        suffix: null,\n        compress: null\n    }\n    $.extend(settings, options)\n    this.settings = settings\n\n    this.setup()\n    this.bind()\n}\n\n// initialize\n// create input, form, iframe\nUploader.prototype.setup = function () {\n    this.form = $(\n        '<form method=\"post\" enctype=\"multipart/form-data\"'\n        + 'target=\"\" action=\"' + this.settings.action + '\" />'\n    )\n\n    var data = this.settings.data\n    this.form.append(createInputs(data))\n\n    var input = document.createElement('input')\n    input.type = 'file'\n    input.name = this.settings.name\n    if (this.settings.accept) {\n        input.accept = this.settings.accept\n    }\n    if (this.settings.multiple) {\n        input.multiple = true\n        input.setAttribute('multiple', 'multiple')\n    }\n    this.input = $(input)\n\n    var $trigger = $(this.settings.trigger)\n    this.input.attr('hidefocus', true).css({\n        position: 'absolute',\n        top: 0,\n        right: 0,\n        opacity: 0,\n        outline: 0,\n        cursor: 'pointer',\n        height: $trigger.outerHeight(),\n        fontSize: Math.max(64, $trigger.outerHeight() * 5)\n    })\n    this.form.append(this.input)\n    this.form.css({\n        position: 'absolute',\n        top: $trigger.offset().top,\n        left: $trigger.offset().left,\n        overflow: 'hidden',\n        width: $trigger.outerWidth(),\n        height: $trigger.outerHeight(),\n        zIndex: findzIndex($trigger) + 10\n    }).appendTo('body')\n    return this\n}\n\n// bind events\nUploader.prototype.bind = function () {\n    var self = this\n    var $trigger = $(self.settings.trigger)\n    $trigger.mouseenter(function () {\n        self.form.css({\n            top: $trigger.offset().top,\n            left: $trigger.offset().left,\n            width: $trigger.outerWidth(),\n            height: $trigger.outerHeight()\n        })\n    })\n    self.bindInput()\n}\n\nUploader.prototype.bindInput = function () {\n    var self = this\n    self.files = []\n    self.input.change(function(e) {\n        self.files = []\n\n        // ie9- don't support FileList Object\n        var files = this.files || [{\n            name: e.target.value.split('\\\\').pop()\n        }]\n\n        // 根据文件后缀进行过滤\n        var suffix = ''\n        for (var i = 0; i < files.length; i++) {\n            suffix = files[i].name.split('.').pop()\n            if (self.settings.suffix.indexOf(suffix) === -1) {\n                if (self.settings.error) {\n                    self.settings.error(new Error('type error'), files[i].name)\n                }\n            } else {\n                self.files.push(files[i])\n            }\n        }\n\n        // no accept suffix\n        if (!self.files.length) {\n            return\n        }\n        if (self.settings.change) {\n            self.settings.change.call(self, self.files)\n        } else {\n            self.submit()\n        }\n    })\n}\n\n// handle submit event\n// prepare for submiting form\nUploader.prototype.submit = function () {\n    if (window.FormData) {\n        this.ajaxSubmit()\n    } else {\n        this.formSubmit()\n    }\n}\n\nUploader.prototype.ajaxSubmit = function () {\n    var self = this\n\n    // upyun server do not support multiple files upload\n    var files = self.files\n    self.input.prop('disabled', true)\n    var form = new FormData(self.form.get(0))\n    self.input.prop('disabled', false)\n\n    for (var i = 0; i < files.length; i++) {\n        (function (file) {\n            compress(file, self.settings.compress)['catch'](function (err) {\n\n                // compress failed\n                if (self.settings.error) {\n                    self.settings.error(new Error('图片压缩失败'), file.name)\n                }\n            }).then(function (blob) {\n                blob = blob || file\n                form.append(self.settings.name, blob, file.name)\n                $.ajax({\n                    url: self.settings.action,\n                    type: 'post',\n                    processData: false,\n                    contentType: false,\n                    data: form,\n                    xhr: function () {\n                        var xhr = $.ajaxSettings.xhr()\n                        if (xhr.upload && self.settings.progress) {\n                            xhr.upload.addEventListener('progress', function(event) {\n                                var percent = 0\n                                var position = event.loaded || event.position\n                                var total = event.total\n                                if (event.lengthComputable) {\n                                    percent = Math.ceil(position / total * 100)\n                                }\n                                self.settings.progress(event, position, total, percent, file.name)\n                            }, false)\n                        }\n                        return xhr\n                    },\n                    success: function (data) {\n                        if (self.settings.success) {\n                            self.settings.success(data, file.name)\n                        }\n                    },\n                    error: function (xhr, textStatus, errorMsg) {\n                        if (self.settings.error) {\n                            self.settings.error(new Error(errorMsg), file.name)\n                        }\n                    }\n                })\n            })\n        })(files[i])\n    }\n}\n\nUploader.prototype.formSubmit = function () {\n    var self = this\n    self.iframe = newIframe()\n    self.form.attr('target', self.iframe.attr('name'))\n    self.iframe.data('fileName', self.files[0].name)\n    $('body').append(self.iframe)\n    self.iframe.one('load', function () {\n\n        // Fix for IE endless progress bar activity bug\n        // (happens on form submits to iframe targets):\n        $('<iframe src=\"javascript:false;\"></iframe>')\n            .appendTo(self.form)\n            .remove()\n        var response = ''\n        try {\n            response = $.trim($(this).contents().find(\"body\").html())\n        } catch (e) {\n            if (self.settings.error) {\n                self.settings.error(new Error('cross domain'), $(this).data('fileName'))\n            }\n        }\n        if (response) {\n            if (self.settings.success) {\n                self.settings.success(response, $(this).data('fileName'))\n            }\n        }\n        self.iframe.remove()\n    })\n    self.form.submit()\n}\n\nUploader.prototype.refreshInput = function () {\n\n    //replace the input element, or the same file can not to be uploaded\n    var newInput = this.input.clone()\n    this.input.before(newInput)\n    this.input.off('change')\n    this.input.remove()\n    this.input = newInput\n    this.bindInput()\n}\n\n// handle change event\n// when value in file input changed\nUploader.prototype.change = function(callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.change = callback\n    return this\n}\n\n// handle when upload success\nUploader.prototype.success = function(callback) {\n    var me = this\n    this.settings.success = function(response, fileName) {\n        me.refreshInput()\n        if (callback) {\n            callback(response, fileName)\n        }\n    }\n    return this\n}\n\n// handle when upload error\nUploader.prototype.error = function(callback) {\n    var me = this\n    this.settings.error = function(response, fileName) {\n        if (callback) {\n            me.refreshInput()\n            callback(response, fileName)\n        }\n    }\n    return this\n}\n\n// add progress\nUploader.prototype.progress = function(callback) {\n    if (!callback) {\n        return this\n    }\n    this.settings.progress = callback\n    return this\n}\n\n// Help function\nfunction isType(type) {\n  return function(obj) {\n    return Object.prototype.toString.call(obj) === \"[object \" + type + \"]\"\n  }\n}\n\nfunction createInputs(data) {\n    if (!data) return []\n\n    var inputs = [], i\n    for (var name in data) {\n        i = document.createElement('input')\n        i.type = 'hidden'\n        i.name = name\n        i.value = data[name]\n        inputs.push(i)\n    }\n    return inputs\n}\n\nfunction findzIndex($node) {\n    var parents = $node.parentsUntil('body')\n    var zIndex = 0\n    for (var i = 0; i < parents.length; i++) {\n        var item = parents.eq(i)\n        if (item.css('position') !== 'static') {\n            zIndex = parseInt(item.css('zIndex'), 10) || zIndex\n        }\n    }\n    return zIndex\n}\n\nfunction newIframe() {\n    var iframeName = 'iframe-uploader-' + iframeCount\n    var iframe = $('<iframe name=\"' + iframeName + '\" />').hide()\n    iframeCount += 1\n    return iframe\n}\n\nmodule.exports = Uploader\n\n},{\"./lib/compress\":1}],\"upyun\":[function(require,module,exports){\n(function (global){\n'use strict'\n\nvar ES6Promise = (typeof window !== \"undefined\" ? window.ES6Promise : typeof global !== \"undefined\" ? global.ES6Promise : null)\nvar compress = require('./lib/compress')\n\nES6Promise.polyfill()\n\n// get server config\nvar getJson = function (url, data) {\n    return new Promise(function (resolve, reject) {\n        $.ajax({\n            url: url,\n            data: data,\n            success: function (response) {\n                if (response.success) {\n                    resolve(response.message)\n                } else {\n                    reject(new Error(response.message))\n                }\n            },\n            error: function (xhr, textStatus, errorMsg) {\n                reject(new Error(errorMsg))\n            }\n        })\n    })\n}\n\nexports.getConfig = function (path, options) {\n    path = path || '/config/upyun/'\n    window.location.origin = window.location.origin ||\n        window.location.protocol + \"//\" + window.location.hostname +\n        (window.location.port ? ':' + window.location.port: '')\n    var url = window.location.origin + path\n    options = options || {}\n    if (window.FormData) {\n        if (options['return-url']) {\n            delete options['return-url']\n        }\n    } else {\n        options['return-url'] = true\n    }\n    return getJson(url, options).then(function (response) {\n        var data = {}\n        data.policy = response.policy\n        data.signature = response.signature\n        var action = 'http://v0.api.upyun.com/' + response.bucket\n        var config = {\n            data: data,\n            action: action,\n            name: 'file'\n        }\n        return config\n    })\n}\n\nexports.getPath = function (response) {\n    var url = $.parseJSON(response).url\n    url = 'http://bxmedia.b0.upaiyun.com' + url\n    return url\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./lib/compress\":1}]},{},[\"upload\",\"upyun\"]);\n"],"sourceRoot":"/source/"}