!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.Upload=t()}}(function(){return function t(e,i,n){function o(s,u){if(!i[s]){if(!e[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(r)return r(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var p=i[s]={exports:{}};e[s][0].call(p.exports,function(t){var i=e[s][1][t];return o(i?i:t)},p,p.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e){(function(i){"use strict";function n(t){if(!(this instanceof n))return new n(t);"object"!=typeof t&&(t={});var e={trigger:null,name:"file",action:"/upload",accept:null,data:null,multiple:!0,select:null,error:null,success:null,progress:null,compress:!1,timeout:1e4};$.extend(e,t),this.settings=e,this.setup(),this.bind()}function o(t){if(!t)return[];var e,i=[];for(var n in t)e=document.createElement("input"),e.type="hidden",e.name=n,e.value=t[n],i.push(e);return i}function r(t){var e=0;return $.each(t.parents(),function(t,i){return i===$("body")[0]?!1:void("static"!==$(i).css("position")&&(e=parseInt($(i).css("zIndex"),10)||e))}),e}function s(){var t="iframe-Upload-"+f,e=$('<iframe name="'+t+'" />').hide();return f+=1,e}var u="undefined"!=typeof window?window.ES6Promise:"undefined"!=typeof i?i.ES6Promise:null,a=t("./compress");u.polyfill();var f=0,p=0;n.prototype.setup=function(){this.form=$('<form method="post" enctype="multipart/form-data"target="" action="'+this.settings.action+'" />');var t=this.settings.data;this.form.append(o(t));var e=document.createElement("input");e.type="file",e.name=this.settings.name,this.settings.accept&&(e.accept=this.settings.accept),this.settings.multiple&&(e.multiple=!0,e.setAttribute("multiple","multiple")),this.input=$(e);var i=$(this.settings.trigger),n=i.outerWidth?i.outerWidth():i[0].offsetWidth,s=i.outerHeight?i.outerHeight():i[0].offsetHeight;this.input.attr("hidefocus",!0).css({position:"absolute",top:0,right:0,opacity:0,outline:0,cursor:"pointer",width:n,height:s,fontSize:Math.max(64,5*s)}),this.form.append(this.input),this.form.css({position:"absolute",top:i.offset().top,left:i.offset().left,overflow:"hidden",width:n,height:s,zIndex:r(i)+10}).appendTo("body")},n.prototype.bind=function(){var t=this,e=$(t.settings.trigger),i=e.outerWidth?e.outerWidth():e[0].offsetWidth,n=e.outerHeight?e.outerHeight():e[0].offsetHeight;e.mouseenter(function(){t.form.css({top:e.offset().top,left:e.offset().left,width:i,height:n})}),t.bindInput()},n.prototype.bindInput=function(){var t=this;t.files=[],t.input.change(function(e){t.files=this.files||[{name:e.target.value.split("\\").pop()}],t.uids=$.map(t.files,function(){return p++}),t.settings.select?t.settings.select.call(t,t.files,t.uids):t.submit()})},n.prototype.submit=function(){window.FormData?(this.ajaxSubmit(this.files,this.uids),this.refreshInput()):this.formSubmit(this.uids[0])},n.prototype.ajaxSubmit=function(t,e){var i=this,n=[];return $.each(t,function(t,o){var r=a(o,i.settings.compress)["catch"](function(){return o}).then(function(e){i.input.prop("disabled",!0);var n=new FormData(i.form.get(0));return n.append(i.settings.name,e,o.name),i.input.prop("disabled",!1),new Promise(function(e,o){$.ajax({url:i.settings.action,type:"post",processData:!1,contentType:!1,data:n,timeout:i.settings.timeout,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&i.settings.progress&&e.upload.addEventListener("progress",function(e){var n=0,o=e.loaded||e.position,r=e.total;e.lengthComputable&&(n=Math.ceil(o/r*100)),i.settings.progress(o,r,n,i.uids[t])},!1),e},success:function(t){e(t)},error:function(t,e,i){i&&(i=" "+i);var n="upload error: "+e+i;o(new Error(n))}})})}).then(function(n){i.settings.success&&i.settings.success(n,e[t])},function(n){i.settings.error&&i.settings.error(n,e[t])});n.push(r)}),Promise.all(n)},n.prototype.formSubmit=function(t){var e=this;return new Promise(function(t,i){e.iframe=s(),e.form.attr("target",e.iframe.attr("name")),$("body").append(e.iframe);var n=null;e.iframe.one("load",function(){clearTimeout(n),$('<iframe src="javascript:false;"></iframe>').appendTo(e.form).remove();var i=$.trim($(this).contents().find("body").html());t(i)}),e.form.submit(),e.refreshInput(),n=setTimeout(function(){i(new Error("upload error: timeout"))},e.settings.timeout)}).then(function(i){e.settings.success&&e.settings.success(i,t)},function(i){e.settings.error&&e.settings.error(i,t)}).then(function(){e.iframe.remove()})},n.prototype.refreshInput=function(){var t=this.input.clone();this.input.before(t),this.input.off("change"),this.input.remove(),this.input=t,this.bindInput()},n.prototype.select=function(t){return t?(this.settings.select=t,this):this},n.prototype.success=function(t){return t?(this.settings.success=t,this):this},n.prototype.error=function(t){return t?(this.settings.error=t,this):this},n.prototype.progress=function(t){return t?(this.settings.progress=t,this):this},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./compress":2}],2:[function(t,e){(function(t){"use strict";function i(t,e){return e===!1?Promise.resolve(t):window.File&&window.FileReader&&window.URL?t instanceof File?/image/i.test(t.type)?("object"!=typeof e&&(e={}),new Promise(function(i){var r=new FileReader;r.readAsArrayBuffer(t),r.onload=function(r){var s=new Blob([r.target.result]);window.URL=window.URL||window.webkitURL;var u=window.URL.createObjectURL(s),a=new Image;a.src=u,a.onload=function(){var r=n(a,t.type,e),s=o(r);i(s)}}})):Promise.reject(new Error("file is not image")):Promise.reject(new Error("file invalid")):Promise.reject(new Error("File API not support"))}function n(t,e,i){var n=t.width,o=t.height,r=i.max_width||n,s=i.max_height||o,u=i.quality||null;n>o?n>r&&(o=Math.round(o*=r/n),n=r):o>s&&(n=Math.round(n*=s/o),o=s);var a=document.createElement("canvas");a.width=n,a.height=o;var f=a.getContext("2d");return f.drawImage(t,0,0,n,o),a.toDataURL(e,u)}function o(t){var e="";e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var i=t.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return new Blob([n],{type:i})}var r="undefined"!=typeof window?window.ES6Promise:"undefined"!=typeof t?t.ES6Promise:null;r.polyfill(),e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});
//# sourceMappingURL=upload.min.js.map