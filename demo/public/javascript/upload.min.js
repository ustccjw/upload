!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.Upload=t()}}(function(){return function t(e,i,n){function r(s,u){if(!i[s]){if(!e[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(o)return o(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var p=i[s]={exports:{}};e[s][0].call(p.exports,function(t){var i=e[s][1][t];return r(i?i:t)},p,p.exports,t,e,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e){(function(i){"use strict";function n(t){if(!(this instanceof n))return new n(t);"object"!=typeof t&&(t={});var e={trigger:null,name:"file",action:"/upload",accept:null,data:null,multiple:!0,select:null,error:null,success:null,progress:null,compress:!1};$.extend(e,t),this.settings=e,this.setup(),this.bind()}function r(t){if(!t)return[];var e,i=[];for(var n in t)e=document.createElement("input"),e.type="hidden",e.name=n,e.value=t[n],i.push(e);return i}function o(t){for(var e=t.parentsUntil("body"),i=0,n=0;n<e.length;n++){var r=e.eq(n);"static"!==r.css("position")&&(i=parseInt(r.css("zIndex"),10)||i)}return i}function s(){var t="iframe-Upload-"+f,e=$('<iframe name="'+t+'" />').hide();return f+=1,e}var u="undefined"!=typeof window?window.ES6Promise:"undefined"!=typeof i?i.ES6Promise:null,a=t("./compress");u&&u.polyfill();var f=0,p=1e4,l=0;n.prototype.setup=function(){this.form=$('<form method="post" enctype="multipart/form-data"target="" action="'+this.settings.action+'" />');var t=this.settings.data;this.form.append(r(t));var e=document.createElement("input");e.type="file",e.name=this.settings.name,this.settings.accept&&(e.accept=this.settings.accept),this.settings.multiple&&(e.multiple=!0,e.setAttribute("multiple","multiple")),this.input=$(e);var i=$(this.settings.trigger);this.input.attr("hidefocus",!0).css({position:"absolute",top:0,right:0,opacity:0,outline:0,cursor:"pointer",height:i.outerHeight(),fontSize:Math.max(64,5*i.outerHeight())}),this.form.append(this.input),this.form.css({position:"absolute",top:i.offset().top,left:i.offset().left,overflow:"hidden",width:i.outerWidth(),height:i.outerHeight(),zIndex:o(i)+10}).appendTo("body")},n.prototype.bind=function(){var t=this,e=$(t.settings.trigger);e.mouseenter(function(){t.form.css({top:e.offset().top,left:e.offset().left,width:e.outerWidth(),height:e.outerHeight()})}),t.bindInput()},n.prototype.bindInput=function(){var t=this;t.files=[],t.input.change(function(e){t.files=this.files||[{name:e.target.value.split("\\").pop()}],t.uids=$.map(t.files,function(){return l++}),t.settings.select?t.settings.select.call(t,t.files,t.uids):t.submit()})},n.prototype.submit=function(){window.FormData?this.ajaxSubmit():this.formSubmit()},n.prototype.ajaxSubmit=function(){var t=this,e=t.files;t.input.prop("disabled",!0);var i=new FormData(t.form.get(0));t.input.prop("disabled",!1);var n=[];$.each(e,function(e,r){var o=a(r,t.settings.compress)["catch"](function(i){t.settings.error&&t.settings.error(new Error("compress error: "+i.message),t.uids[e])}).then(function(n){return n=n||r,i.append(t.settings.name,n,r.name),new Promise(function(n){$.ajax({url:t.settings.action,type:"post",processData:!1,contentType:!1,data:i,timeout:p,xhr:function(){var i=$.ajaxSettings.xhr();return i.upload&&t.settings.progress&&i.upload.addEventListener("progress",function(i){var n=0,r=i.loaded||i.position,o=i.total;i.lengthComputable&&(n=Math.ceil(r/o*100)),t.settings.progress(r,o,n,t.uids[e])},!1),i},success:function(i){t.settings.success&&t.settings.success(i,t.uids[e]),n()},error:function(i,r){t.settings.error&&t.settings.error(new Error("upload error: "+r),t.uids[e]),n()}})})});n.push(o)}),Promise.all(n).then(function(){t.refreshInput()})},n.prototype.formSubmit=function(){var t=this;t.iframe=s(),t.form.attr("target",t.iframe.attr("name")),t.iframe.data("uid",t.uids[0]),$("body").append(t.iframe);var e=null;t.iframe.one("load",function(){clearTimeout(e),$('<iframe src="javascript:false;"></iframe>').appendTo(t.form).remove();var i=null;try{i=$.trim($(this).contents().find("body").html())}catch(n){t.settings.error&&t.settings.error(new Error("upload error: cross domain"),$(this).data("uid"))}finally{null!==i&&t.settings.success&&t.settings.success(i,$(this).data("uid")),t.refreshInput(),$(this).remove()}}),t.form.submit(),e=setTimeout(function(){t.settings.error&&t.settings.error(new Error("upload error: timeout"),t.iframe.data("uid")),t.refreshInput(),t.iframe.remove()},p)},n.prototype.refreshInput=function(){var t=this.input.clone();this.input.before(t),this.input.off("change"),this.input.remove(),this.input=t,this.bindInput()},n.prototype.select=function(t){return t?(this.settings.select=t,this):this},n.prototype.success=function(t){return t?(this.settings.success=t,this):this},n.prototype.error=function(t){return t?(this.settings.error=t,this):this},n.prototype.progress=function(t){return t?(this.settings.progress=t,this):this},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./compress":2}],2:[function(t,e){(function(t){"use strict";function i(t,e){return e===!1?Promise.resolve(t):window.File&&window.FileReader&&window.URL?t instanceof File?/image/i.test(t.type)?("object"!=typeof e&&(e={}),new Promise(function(i){var o=new FileReader;o.readAsArrayBuffer(t),o.onload=function(o){var s=new Blob([o.target.result]);window.URL=window.URL||window.webkitURL;var u=window.URL.createObjectURL(s),a=new Image;a.src=u,a.onload=function(){var o=n(a,t.type,e),s=r(o);i(s)}}})):Promise.reject(new Error("file is not image")):Promise.reject(new Error("file invalid")):Promise.reject(new Error("File API not support"))}function n(t,e,i){var n=t.width,r=t.height,o=i.max_width||n,s=i.max_height||r,u=i.quality||null;n>r?n>o&&(r=Math.round(r*=o/n),n=o):r>s&&(n=Math.round(n*=s/r),r=s);var a=document.createElement("canvas");a.width=n,a.height=r;var f=a.getContext("2d");return f.drawImage(t,0,0,n,r),a.toDataURL(e,u)}function r(t){var e="";e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var i=t.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return new Blob([n],{type:i})}var o="undefined"!=typeof window?window.ES6Promise:"undefined"!=typeof t?t.ES6Promise:null;o&&o.polyfill(),e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});
//# sourceMappingURL=upload.min.js.map